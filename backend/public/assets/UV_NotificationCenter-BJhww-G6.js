import{a as Q,u as z,b as M,j as e}from"./state-vendor-__gb9IU9.js";import{u as W,e as V,r as Y}from"./react-vendor-QYi6USC3.js";import{u as D,a as C}from"./index-CWUh35PH.js";import{B as H,a5 as _,Y as k,h as J,ao as G,W as X,K as Z,ap as ee,e as se,f as te,ai as ae,y as re,P as ne}from"./ui-vendor-CuJPReAW.js";const le=async(r,t)=>{const l=new URLSearchParams;return t.notification_type&&t.notification_type!=="all"&&l.append("notification_type",t.notification_type),t.is_read!==void 0&&l.append("is_read",String(t.is_read)),l.append("limit",String(t.limit)),l.append("offset",String(t.offset)),(await C.get(`https://123create-construction-app-with-a.launchpulse.ai/api/notifications?${l.toString()}`,{headers:{Authorization:`Bearer ${r}`}})).data},ie=async(r,t)=>(await C.patch(`https://123create-construction-app-with-a.launchpulse.ai/api/notifications/${t}/read`,{},{headers:{Authorization:`Bearer ${r}`}})).data,oe=async r=>(await C.post("https://123create-construction-app-with-a.launchpulse.ai/api/notifications/read-all",{},{headers:{Authorization:`Bearer ${r}`}})).data,ce=r=>{const t=new Date(r),u=new Date().getTime()-t.getTime(),d=Math.floor(u/6e4),m=Math.floor(u/36e5),i=Math.floor(u/864e5);return d<1?"Just now":d<60?`${d} min ago`:m<24?`${m} hour${m>1?"s":""} ago`:i<7?`${i} day${i>1?"s":""} ago`:t.toLocaleDateString("en-US",{month:"short",day:"numeric"})},de=r=>{switch(r){case"order_update":return ne;case"promotion":return re;case"price_drop":return ae;case"back_in_stock":return te;case"message":return se;case"system":default:return ee}},me=r=>{switch(r){case"order_update":return"text-blue-600 bg-blue-100";case"promotion":return"text-purple-600 bg-purple-100";case"price_drop":return"text-green-600 bg-green-100";case"back_in_stock":return"text-emerald-600 bg-emerald-100";case"message":return"text-amber-600 bg-amber-100";case"system":default:return"text-gray-600 bg-gray-100"}},xe=r=>{switch(r){case"all":return"All";case"order_update":return"Orders";case"promotion":case"price_drop":case"back_in_stock":return"Alerts";default:return"All"}},be=()=>{const r=W(),[t,l]=V(),u=Q(),d=D(s=>s.authentication_state.auth_token),[m,i]=Y.useState([]),x=t.get("filter_type")||"all",h=t.get("unread_only")==="true",o=parseInt(t.get("page")||"1",10),p=20,{data:n,isLoading:A,isError:P,error:S,refetch:R}=z({queryKey:["notifications",x,h,o,p],queryFn:()=>{if(!d)throw new Error("Authentication required");return le(d,{notification_type:x==="orders"?"order_update":x==="alerts"?void 0:x!=="all"?x:void 0,is_read:h?!1:void 0,limit:p,offset:(o-1)*p})},enabled:!!d,staleTime:3e4,refetchOnWindowFocus:!0}),g=M({mutationFn:s=>{if(!d)throw new Error("Authentication required");return ie(d,s)},onSuccess:()=>{u.invalidateQueries({queryKey:["notifications"]}),n&&n.unread_count>0}}),N=M({mutationFn:()=>{if(!d)throw new Error("Authentication required");return oe(d)},onSuccess:()=>{u.invalidateQueries({queryKey:["notifications"]}),i([])}}),F=s=>{const a=new URLSearchParams(t);s==="all"?a.delete("filter_type"):a.set("filter_type",s),a.delete("page"),l(a),i([])},L=()=>{const s=new URLSearchParams(t);h?s.delete("unread_only"):s.set("unread_only","true"),s.delete("page"),l(s),i([])},j=s=>{const a=new URLSearchParams(t);s===1?a.delete("page"):a.set("page",String(s)),l(a),i([])},T=async s=>{s.is_read||await g.mutateAsync(s.notification_id),s.action_url&&r(s.action_url)},U=s=>{i(a=>a.includes(s)?a.filter(c=>c!==s):[...a,s])},q=()=>{n&&(m.length===n.notifications.length?i([]):i(n.notifications.map(s=>s.notification_id)))},E=async()=>{if(m.length!==0)try{await Promise.all(m.map(s=>g.mutateAsync(s))),i([])}catch(s){console.error("Failed to mark notifications as read:",s)}},B=async()=>{try{await N.mutateAsync()}catch(s){console.error("Failed to mark all as read:",s)}},b=(n==null?void 0:n.notifications)||[],w=(n==null?void 0:n.total)||0,f=(n==null?void 0:n.unread_count)||0,y=Math.ceil(w/p),I=[{value:"all",label:"All"},{value:"orders",label:"Orders"},{value:"alerts",label:"Alerts"}],O=m.length>0,K=b.length>0&&m.length===b.length;return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(H,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Notifications"}),f>0&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[f," unread notification",f!==1?"s":""]})]})]}),f>0&&e.jsxs("button",{onClick:B,disabled:N.isPending,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[N.isPending?e.jsx(_,{className:"w-4 h-4 animate-spin"}):e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Mark All as Read"})]})]}),e.jsx("div",{className:"flex items-center space-x-2 mt-6 border-b border-gray-200",children:I.map(s=>e.jsx("button",{onClick:()=>F(s.value),className:`px-4 py-2 text-sm font-medium transition-colors border-b-2 ${x===s.value?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300"}`,children:s.label},s.value))})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:L,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"Unread only"})]}),b.length>0&&e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:K,onChange:q,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:"Select all"})]})]}),O&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[m.length," selected"]}),e.jsxs("button",{onClick:E,disabled:g.isPending,className:"flex items-center space-x-2 px-3 py-1.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 text-sm",children:[g.isPending?e.jsx(_,{className:"w-4 h-4 animate-spin"}):e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{children:"Mark as Read"})]})]})]})}),A&&e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4",children:[e.jsx(_,{className:"w-8 h-8 text-blue-600 animate-spin"}),e.jsx("p",{className:"text-gray-600",children:"Loading notifications..."})]})}),P&&e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-red-200 p-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(J,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-1",children:"Failed to load notifications"}),e.jsx("p",{className:"text-sm text-red-700 mb-4",children:S instanceof Error?S.message:"An error occurred"}),e.jsx("button",{onClick:()=>R(),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium",children:"Try Again"})]})]})}),!A&&!P&&e.jsxs(e.Fragment,{children:[b.length===0?e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 text-center",children:[e.jsx("div",{className:"p-4 bg-gray-100 rounded-full",children:e.jsx(G,{className:"w-12 h-12 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:h?"No unread notifications":x!=="all"?`No ${xe(x).toLowerCase()} notifications`:"No notifications yet"}),e.jsx("p",{className:"text-sm text-gray-600",children:h?"You're all caught up!":"We'll notify you when there's something new"})]}),(h||x!=="all")&&e.jsx("button",{onClick:()=>{const s=new URLSearchParams;l(s)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"View all notifications"})]})}):e.jsx("div",{className:"space-y-3",children:b.map(s=>{const a=de(s.notification_type),c=me(s.notification_type),$=m.includes(s.notification_id);return e.jsx("div",{className:`bg-white rounded-lg shadow-sm border transition-all ${s.is_read?"border-gray-200 hover:border-gray-300":"border-blue-200 bg-blue-50/30 hover:border-blue-300"} ${$?"ring-2 ring-blue-500":""}`,children:e.jsxs("div",{className:"p-4 flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0 pt-1",children:e.jsx("input",{type:"checkbox",checked:$,onChange:()=>U(s.notification_id),onClick:v=>v.stopPropagation(),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`p-2 rounded-lg ${c}`,children:e.jsx(a,{className:"w-5 h-5"})})}),e.jsxs("button",{onClick:()=>T(s),className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h3",{className:`text-sm font-semibold ${s.is_read?"text-gray-700":"text-gray-900"}`,children:s.title}),!s.is_read&&e.jsx("span",{className:"flex-shrink-0 w-2 h-2 bg-blue-600 rounded-full"})]}),e.jsx("p",{className:`text-sm ${s.is_read?"text-gray-500":"text-gray-700"} line-clamp-2`,children:s.message})]}),e.jsx("div",{className:"flex-shrink-0 text-right",children:e.jsx("span",{className:"text-xs text-gray-500",children:ce(s.created_date)})})]}),s.related_entity_type&&e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-gray-100 text-xs text-gray-600",children:[s.related_entity_type==="order"&&"Order",s.related_entity_type==="product"&&"Product",s.related_entity_type==="delivery"&&"Delivery",!["order","product","delivery"].includes(s.related_entity_type)&&s.related_entity_type]})})]}),!s.is_read&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("button",{onClick:v=>{v.stopPropagation(),g.mutate(s.notification_id)},disabled:g.isPending,className:"p-2 text-gray-400 hover:text-blue-600 transition-colors disabled:opacity-50",title:"Mark as read",children:e.jsx(k,{className:"w-5 h-5"})})})]})},s.notification_id)})}),y>1&&b.length>0&&e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 mt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(o-1)*p+1," to"," ",Math.min(o*p,w)," of ",w," ","notifications"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>j(o-1),disabled:o===1,className:"p-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,y)},(s,a)=>{let c;return y<=5||o<=3?c=a+1:o>=y-2?c=y-4+a:c=o-2+a,e.jsx("button",{onClick:()=>j(c),className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${o===c?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:c},c)})}),e.jsx("button",{onClick:()=>j(o+1),disabled:o===y,className:"p-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(Z,{className:"w-5 h-5"})})]})]})})]})]})})})};export{be as default};
