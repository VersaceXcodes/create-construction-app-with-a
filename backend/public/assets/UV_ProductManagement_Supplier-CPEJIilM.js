import{a as J,u as U,b as W,j as e}from"./state-vendor-__gb9IU9.js";import{e as Z,r as o,L as w}from"./react-vendor-QYi6USC3.js";import{u as ee,a as k}from"./index-BLkJOUb3.js";import{w as $,S as te,X as q,P as M,h as L,au as se,a4 as I,T as D,ah as ae,x as re,Y as le}from"./ui-vendor-CuJPReAW.js";const ce=async(x,c,y,s,f)=>{const h=(s-1)*f,m=new URLSearchParams;c.status&&m.append("status_filter",c.status),c.category_id&&m.append("category_filter",c.category_id),c.search_query&&m.append("search_query",c.search_query),m.append("sort_by",y.sort_by),m.append("limit",f.toString()),m.append("offset",h.toString());const l=await k.get(`https://123create-construction-app-with-a.launchpulse.ai/api/suppliers/me/products?${m.toString()}`,{headers:{Authorization:`Bearer ${x}`,"Content-Type":"application/json"}});return{products:l.data.products.map(r=>{var d;return{product_id:r.product_id,sku:r.sku,product_name:r.product_name,category_id:r.category_id,category_name:((d=r.category)==null?void 0:d.category_name)||"Unknown",price_per_unit:Number(r.price_per_unit||0),stock_quantity:Number(r.stock_quantity||0),status:r.status,is_featured:r.is_featured,views_count:Number(r.views_count||0),sales_count:Number(r.sales_count||0),last_updated_timestamp:r.last_updated_timestamp,primary_image_url:r.primary_image_url}}),pagination:{current_page:Math.floor(l.data.offset/l.data.limit)+1,total_pages:Math.ceil(l.data.total/l.data.limit),total_count:l.data.total,limit:l.data.limit}}},E=async(x,c,y)=>{await k.patch(`https://123create-construction-app-with-a.launchpulse.ai/api/products/${c}`,{status:y},{headers:{Authorization:`Bearer ${x}`,"Content-Type":"application/json"}})},ie=async()=>(await k.get("https://123create-construction-app-with-a.launchpulse.ai/api/categories?is_active=true")).data;function xe(){var T;const x=ee(t=>t.authentication_state.auth_token),[c,y]=Z(),[s,f]=o.useState({status:c.get("status_filter"),category_id:c.get("category_filter"),search_query:c.get("search_query")}),[h,m]=o.useState({sort_by:c.get("sort_by")||"created_at",sort_order:"desc"}),[l,r]=o.useState(parseInt(c.get("page")||"1")),[d,j]=o.useState([]),[v,S]=o.useState(s.search_query||""),[K,P]=o.useState(!1),O=24,A=J(),{data:p,isLoading:N,error:g}=U({queryKey:["supplier-products",s,h,l],queryFn:()=>ce(x,s,h,l,O),enabled:!!x,staleTime:6e4,retry:1}),{data:b}=U({queryKey:["categories"],queryFn:ie,staleTime:3e5,retry:1}),F=W({mutationFn:({productId:t,status:a})=>E(x,t,a),onSuccess:()=>{A.invalidateQueries({queryKey:["supplier-products"]})}}),n=o.useMemo(()=>(p==null?void 0:p.products)||[],[p]),u=(p==null?void 0:p.pagination)||{current_page:1,total_pages:1,total_count:0},C=d.length>0&&d.length===n.length,B=d.length>0&&d.length<n.length;o.useEffect(()=>{const t=new URLSearchParams;s.status&&t.set("status_filter",s.status),s.category_id&&t.set("category_filter",s.category_id),s.search_query&&t.set("search_query",s.search_query),h.sort_by!=="created_at"&&t.set("sort_by",h.sort_by),l>1&&t.set("page",l.toString()),y(t,{replace:!0})},[s,h,l,y]),o.useEffect(()=>{const t=setTimeout(()=>{v!==s.search_query&&(f(a=>({...a,search_query:v||null})),r(1))},500);return()=>clearTimeout(t)},[v,s.search_query]);const _=o.useCallback((t,a)=>{f(i=>({...i,[t]:a})),r(1)},[]),Q=o.useCallback(t=>{m(a=>a.sort_by===t?{...a,sort_order:a.sort_order==="asc"?"desc":"asc"}:{sort_by:t,sort_order:"desc"})},[]),R=o.useCallback(()=>{j(C?[]:n.map(t=>t.product_id))},[C,n]),V=o.useCallback(t=>{j(a=>a.includes(t)?a.filter(i=>i!==t):[...a,t])},[]),z=async(t,a)=>{try{await F.mutateAsync({productId:t,status:a})}catch(i){console.error("Failed to update product status:",i)}},Y=()=>{f({status:null,category_id:null,search_query:null}),S(""),r(1)},X=async t=>{P(!0);try{await Promise.all(d.map(a=>E(x,a,t))),A.invalidateQueries({queryKey:["supplier-products"]}),j([])}catch(a){console.error("Bulk update failed:",a)}finally{P(!1)}},G=t=>{switch(t){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-gray-100 text-gray-800";case"out_of_stock":return"bg-red-100 text-red-800";case"discontinued":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},H=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Product Catalog"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Manage your product listings, inventory, and performance"})]}),e.jsxs(w,{to:"/supplier/products/add",className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:[e.jsx($,{className:"w-5 h-5 mr-2"}),"Add Product"]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Products"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"search",type:"text",value:v,onChange:t=>S(t.target.value),placeholder:"Search by name or SKU...",className:"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status-filter",className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{id:"status-filter",value:s.status||"",onChange:t=>_("status",t.target.value||null),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"out_of_stock",children:"Out of Stock"}),e.jsx("option",{value:"discontinued",children:"Discontinued"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category-filter",className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{id:"category-filter",value:s.category_id||"",onChange:t=>_("category_id",t.target.value||null),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all",children:[e.jsx("option",{value:"",children:"All Categories"}),b==null?void 0:b.map(t=>e.jsx("option",{value:t.category_id,children:t.category_name},t.category_id))]})]})]}),(s.status||s.category_id||s.search_query)&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"Active filters:"}),s.status&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800",children:["Status: ",s.status,e.jsx("button",{onClick:()=>_("status",null),className:"ml-2 hover:bg-blue-200 rounded-full p-0.5",children:e.jsx(q,{className:"w-3 h-3"})})]}),s.category_id&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800",children:["Category: ",(T=b==null?void 0:b.find(t=>t.category_id===s.category_id))==null?void 0:T.category_name,e.jsx("button",{onClick:()=>_("category_id",null),className:"ml-2 hover:bg-blue-200 rounded-full p-0.5",children:e.jsx(q,{className:"w-3 h-3"})})]}),s.search_query&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800",children:['Search: "',s.search_query,'"',e.jsx("button",{onClick:()=>{_("search_query",null),S("")},className:"ml-2 hover:bg-blue-200 rounded-full p-0.5",children:e.jsx(q,{className:"w-3 h-3"})})]}),e.jsx("button",{onClick:Y,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Clear all filters"})]})]}),d.length>0&&e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[d.length," product",d.length!==1?"s":""," selected"]}),e.jsx("button",{onClick:()=>j([]),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Clear selection"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Bulk actions:"}),e.jsxs("select",{onChange:t=>{t.target.value&&(X(t.target.value),t.target.value="")},disabled:K,className:"px-4 py-2 border-2 border-gray-200 rounded-lg text-sm font-medium focus:border-blue-500 focus:ring-4 focus:ring-blue-100 disabled:opacity-50",children:[e.jsx("option",{value:"",children:"Update Status..."}),e.jsx("option",{value:"active",children:"Set Active"}),e.jsx("option",{value:"inactive",children:"Set Inactive"}),e.jsx("option",{value:"discontinued",children:"Mark Discontinued"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"border-b border-gray-200 bg-gray-50 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(M,{className:"w-5 h-5 text-gray-600"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-700",children:[u.total_count," Products"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sort by:"}),e.jsxs("select",{value:h.sort_by,onChange:t=>Q(t.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-lg text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100",children:[e.jsx("option",{value:"created_at",children:"Date Added"}),e.jsx("option",{value:"product_name",children:"Name"}),e.jsx("option",{value:"sales_count",children:"Sales"}),e.jsx("option",{value:"views_count",children:"Views"}),e.jsx("option",{value:"price_per_unit",children:"Price"}),e.jsx("option",{value:"stock_quantity",children:"Stock"})]})]})]})}),N&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-4 border-blue-600"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading products..."})]})}),g&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(L,{className:"w-6 h-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-red-900",children:"Failed to load products"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:k.isAxiosError(g)?g.message:"An unexpected error occurred"})]})]})})}),!N&&!g&&n.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(M,{className:"w-16 h-16 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:s.status||s.category_id||s.search_query?"Try adjusting your filters":"Start by adding your first product"}),!s.status&&!s.category_id&&!s.search_query&&e.jsxs(w,{to:"/supplier/products/add",className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-all",children:[e.jsx($,{className:"w-5 h-5 mr-2"}),"Add Your First Product"]})]}),!N&&!g&&n.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:C,ref:t=>{t&&(t.indeterminate=B)},onChange:R,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Product"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Category"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Price"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Performance"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:d.includes(t.product_id),onChange:()=>V(t.product_id),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0 w-16 h-16 bg-gray-100 rounded-lg overflow-hidden",children:t.primary_image_url?e.jsx("img",{src:t.primary_image_url,alt:t.product_name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(se,{className:"w-8 h-8 text-gray-400"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(w,{to:`/supplier/products/${t.product_id}/edit`,className:"text-sm font-medium text-gray-900 hover:text-blue-600 line-clamp-1",children:t.product_name}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["SKU: ",t.sku]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm text-gray-900",children:t.category_name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm font-medium text-gray-900",children:H(t.price_per_unit)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`text-sm font-medium ${t.stock_quantity===0?"text-red-600":t.stock_quantity<10?"text-amber-600":"text-green-600"}`,children:t.stock_quantity}),t.stock_quantity===0&&e.jsx("span",{className:"text-xs text-red-600 font-medium",children:"Out"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("select",{value:t.status,onChange:a=>z(t.product_id,a.target.value),disabled:F.isPending,className:`text-xs font-medium px-3 py-1.5 rounded-full border-0 focus:ring-2 focus:ring-offset-2 ${G(t.status)}`,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"}),e.jsx("option",{value:"out_of_stock",children:"Out of Stock"}),e.jsx("option",{value:"discontinued",children:"Discontinued"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(I,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-600",children:t.views_count})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(D,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-600",children:t.sales_count})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(w,{to:`/supplier/products/${t.product_id}/edit`,className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit product",children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{console.warn("Delete endpoint not available - feature pending backend implementation")},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors opacity-50 cursor-not-allowed",title:"Delete not available",disabled:!0,children:e.jsx(re,{className:"w-4 h-4"})})]})})]},t.product_id))})]})})]}),!N&&!g&&n.length>0&&u.total_pages>1&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing page ",u.current_page," of ",u.total_pages,"(",u.total_count," total products)"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>r(t=>Math.max(1,t-1)),disabled:l===1,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Previous"}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,u.total_pages)},(t,a)=>{let i;return u.total_pages<=5||l<=3?i=a+1:l>=u.total_pages-2?i=u.total_pages-4+a:i=l-2+a,e.jsx("button",{onClick:()=>r(i),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${l===i?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:i},i)})}),e.jsx("button",{onClick:()=>r(t=>Math.min(u.total_pages,t+1)),disabled:l===u.total_pages,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Next"})]})]}),!N&&!g&&n.length>0&&e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Products"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:n.filter(t=>t.status==="active").length})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(le,{className:"w-6 h-6 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Out of Stock"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:n.filter(t=>t.status==="out_of_stock"||t.stock_quantity===0).length})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx(L,{className:"w-6 h-6 text-red-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Views"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:n.reduce((t,a)=>t+a.views_count,0).toLocaleString()})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(I,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Sales"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:n.reduce((t,a)=>t+a.sales_count,0).toLocaleString()})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(D,{className:"w-6 h-6 text-purple-600"})})]})})]})]})})})}export{xe as default};
