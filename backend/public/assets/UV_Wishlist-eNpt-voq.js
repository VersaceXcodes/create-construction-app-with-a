import{a as X,u as Z,b as q,j as e}from"./state-vendor-__gb9IU9.js";import{e as ee,r as y,L as w}from"./react-vendor-QYi6USC3.js";import{u as W,a as j}from"./index-C8z-Yyaa.js";import{O as se,Q as te,c as A,h as ae,V as re,x as D,B as F,ae as P}from"./ui-vendor-CuJPReAW.js";const le=async(o,c)=>{const d=new URLSearchParams;return o&&d.append("sort_by",o),c&&d.append("filter_by",c),(await j.get(`/wishlist?${d.toString()}`)).data.map(r=>({wishlist_item_id:r.wishlist_item_id,product_id:r.product_id,product_name:r.product_name,price_when_saved:Number(r.price_when_saved||0),current_price:Number(r.price_per_unit||0),price_drop_amount:Math.max(0,Number(r.price_when_saved||0)-Number(r.price_per_unit||0)),stock_quantity:Number(r.stock_quantity||0),stock_status:Number(r.stock_quantity||0)>0?"in_stock":"out_of_stock",primary_image_url:r.primary_image_url,supplier_name:r.business_name,supplier_id:"",added_date:r.added_date,price_drop_alert_enabled:r.price_drop_alert_enabled,back_in_stock_alert_enabled:r.back_in_stock_alert_enabled}))},U=async(o,c=1)=>(await j.post("/cart/items",{product_id:o,quantity:c})).data,ie=async o=>{await j.delete(`/wishlist/${o}`)},oe=async(o,c,d)=>(await j.patch(`/wishlist/${o}`,{price_drop_alert_enabled:c,back_in_stock_alert_enabled:d})).data,me=()=>{var O,z;const[o,c]=ee(),d=X(),b=o.get("sort_by")||"date_added",r=o.get("filter_by")||"",[_,T]=y.useState("grid"),[m,N]=y.useState([]),[v,E]=y.useState(b),[x,I]=y.useState(r),V=W(s=>s.authentication_state.authentication_status.is_authenticated),M=W(s=>s.fetch_cart);y.useEffect(()=>{E(b),I(r)},[b,r]);const{data:p=[],isLoading:f,error:u,refetch:G}=Z({queryKey:["wishlist",v,x],queryFn:()=>le(v,x),enabled:V,staleTime:6e4,refetchOnWindowFocus:!1,retry:1}),k=q({mutationFn:({product_id:s,quantity:t})=>U(s,t),onSuccess:()=>{M(),d.invalidateQueries({queryKey:["cart"]}),d.invalidateQueries({queryKey:["cart-summary"]})}}),$=q({mutationFn:ie,onSuccess:()=>{d.invalidateQueries({queryKey:["wishlist"]})}}),h=q({mutationFn:({wishlist_item_id:s,price_drop_alert_enabled:t,back_in_stock_alert_enabled:i})=>oe(s,t,i),onSuccess:()=>{d.invalidateQueries({queryKey:["wishlist"]})}}),H=s=>{E(s);const t=new URLSearchParams(o);t.set("sort_by",s),c(t)},C=s=>{I(s);const t=new URLSearchParams(o);s?t.set("filter_by",s):t.delete("filter_by"),c(t)},R=(s,t,i)=>{console.log(`Adding ${t} to cart...`),k.mutate({product_id:s,quantity:1},{onSuccess:()=>{console.log(`Successfully added ${t} to cart`),$.mutate(i,{onSuccess:()=>{console.log(`Removed ${t} from wishlist after adding to cart`)},onError:a=>{console.warn("Failed to remove from wishlist after add to cart:",a)}});const l=document.createElement("div");l.textContent=`${t} added to cart!`,l.style.cssText="position:fixed;top:20px;right:20px;background:#10b981;color:white;padding:16px 24px;border-radius:8px;z-index:9999;box-shadow:0 4px 6px rgba(0,0,0,0.1);",document.body.appendChild(l),setTimeout(()=>l.remove(),3e3)},onError:l=>{var K,B;console.error("Failed to add item to cart:",l);const a=((B=(K=l.response)==null?void 0:K.data)==null?void 0:B.message)||"Failed to add item to cart",g=document.createElement("div");g.textContent=a,g.style.cssText="position:fixed;top:20px;right:20px;background:#ef4444;color:white;padding:16px 24px;border-radius:8px;z-index:9999;box-shadow:0 4px 6px rgba(0,0,0,0.1);",document.body.appendChild(g),setTimeout(()=>g.remove(),3e3)}})},L=(s,t)=>{window.confirm(`Remove "${t}" from wishlist?`)&&$.mutate(s,{onSuccess:()=>{console.log(`Successfully removed ${t} from wishlist`)},onError:i=>{var l,a;console.error("Failed to remove item from wishlist:",i),alert(((a=(l=i.response)==null?void 0:l.data)==null?void 0:a.message)||"Failed to remove item")}})},S=(s,t,i)=>{const l=!i;console.log(`Toggling ${t} alert for ${s}: ${i} -> ${l}`),t==="price"?h.mutate({wishlist_item_id:s,price_drop_alert_enabled:l},{onSuccess:()=>{console.log(`Successfully updated price alert to ${l}`)},onError:a=>{console.error("Failed to update price alert:",a)}}):h.mutate({wishlist_item_id:s,back_in_stock_alert_enabled:l},{onSuccess:()=>{console.log(`Successfully updated stock alert to ${l}`)},onError:a=>{console.error("Failed to update stock alert:",a)}})},Q=s=>{N(t=>t.includes(s)?t.filter(i=>i!==s):[...t,s])},Y=()=>{m.length===p.length?N([]):N(p.map(s=>s.wishlist_item_id))},J=()=>{const s=p.filter(a=>m.includes(a.wishlist_item_id));console.log(`Adding ${s.length} items to cart...`);let t=0,i=0;const l=s.map(a=>U(a.product_id,1).then(()=>{t++}).catch(g=>{console.error(`Failed to add ${a.product_name}:`,g),i++}));Promise.all(l).then(()=>{M(),N([]),d.invalidateQueries({queryKey:["cart"]}),d.invalidateQueries({queryKey:["cart-summary"]});const a=document.createElement("div");a.textContent=`Added ${t} items to cart${i>0?`, ${i} failed`:""}`,a.style.cssText=`position:fixed;top:20px;right:20px;background:${i>0?"#f59e0b":"#10b981"};color:white;padding:16px 24px;border-radius:8px;z-index:9999;box-shadow:0 4px 6px rgba(0,0,0,0.1);`,document.body.appendChild(a),setTimeout(()=>a.remove(),3e3),console.log(`Bulk add complete: ${t} succeeded, ${i} failed`)})},n=[...p.filter(s=>x==="in_stock_only"?s.stock_quantity>0:x==="price_drops"?s.price_drop_amount>0:!0)].sort((s,t)=>v==="price"?s.current_price-t.current_price:new Date(t.added_date).getTime()-new Date(s.added_date).getTime());return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Wishlist"}),e.jsxs("p",{className:"mt-2 text-gray-600",children:[p.length," ",p.length===1?"item":"items"," saved"]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>T("grid"),className:`p-2 rounded-md transition-all ${_==="grid"?"bg-white shadow-sm text-blue-600":"text-gray-600 hover:text-gray-900"}`,"aria-label":"Grid view",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>T("list"),className:`p-2 rounded-md transition-all ${_==="list"?"bg-white shadow-sm text-blue-600":"text-gray-600 hover:text-gray-900"}`,"aria-label":"List view",children:e.jsx(te,{className:"w-5 h-5"})})]}),e.jsxs("select",{value:v,onChange:s=>H(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"date_added",children:"Recently Added"}),e.jsx("option",{value:"price",children:"Price: Low to High"})]})]})]}),e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>C(""),className:`px-4 py-2 rounded-lg border transition-all ${x===""?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-blue-500"}`,children:"All Items"}),e.jsx("button",{onClick:()=>C("in_stock_only"),className:`px-4 py-2 rounded-lg border transition-all ${x==="in_stock_only"?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-blue-500"}`,children:"In Stock Only"}),e.jsx("button",{onClick:()=>C("price_drops"),className:`px-4 py-2 rounded-lg border transition-all ${x==="price_drops"?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:border-blue-500"}`,children:"Price Drops"})]}),n.length>0&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:Y,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:m.length===n.length?"Deselect All":"Select All"}),m.length>0&&e.jsxs("button",{onClick:J,disabled:k.isPending,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsxs("span",{children:["Add ",m.length," to Cart"]})]})]})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[u&&e.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start space-x-3",children:[e.jsx(ae,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-red-800 font-medium",children:"Failed to load wishlist"}),e.jsx("p",{className:"text-red-700 text-sm mt-1",children:j.isAxiosError(u)?((z=(O=u.response)==null?void 0:O.data)==null?void 0:z.message)||u.message:"An error occurred"}),e.jsx("button",{onClick:()=>G(),className:"mt-3 text-sm text-red-600 hover:text-red-700 font-medium underline",children:"Try again"})]})]}),f&&e.jsx("div",{className:_==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6":"space-y-4",children:[1,2,3,4,5,6].map(s=>e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 animate-pulse",children:[e.jsx("div",{className:"aspect-square bg-gray-200 rounded-lg mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-4"}),e.jsx("div",{className:"h-10 bg-gray-200 rounded"})]},s))}),!f&&!u&&n.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx(re,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Your wishlist is empty"}),e.jsx("p",{className:"text-gray-600 mb-6",children:x?"No items match your filter criteria":"Start saving products you love!"}),x?e.jsx("button",{onClick:()=>C(""),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all",children:"Clear Filters"}):e.jsx(w,{to:"/products",className:"inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all",children:"Browse Products"})]}),!f&&!u&&n.length>0&&_==="grid"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:n.map(s=>e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-all group",children:[e.jsxs("div",{className:"relative aspect-square bg-gray-100",children:[e.jsx("input",{type:"checkbox",checked:m.includes(s.wishlist_item_id),onChange:()=>Q(s.wishlist_item_id),className:"absolute top-3 left-3 w-5 h-5 rounded cursor-pointer z-10"}),s.price_drop_amount>0&&e.jsxs("div",{className:"absolute top-3 right-3 bg-green-600 text-white px-3 py-1 rounded-full text-sm font-medium z-10",children:["Price Drop! -",(s.price_drop_amount/s.price_when_saved*100).toFixed(0),"%"]}),e.jsx(w,{to:`/product/${s.product_id}`,className:"block w-full h-full",children:s.primary_image_url?e.jsx("img",{src:s.primary_image_url,alt:s.product_name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-200",children:e.jsx("span",{className:"text-gray-400 text-sm",children:"No image"})})}),e.jsxs("button",{onClick:()=>L(s.wishlist_item_id,s.product_name),disabled:$.isPending,className:"absolute bottom-3 right-3 bg-red-600 text-white p-2.5 rounded-lg shadow-lg hover:bg-red-700 transition-all disabled:opacity-50 flex items-center space-x-1","aria-label":"Remove from wishlist","data-testid":`remove-wishlist-${s.wishlist_item_id}`,title:"Remove from wishlist",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Remove"})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx(w,{to:`/product/${s.product_id}`,className:"block",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2 line-clamp-2 hover:text-blue-600 transition-colors",children:s.product_name})}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.supplier_name}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:["$",s.current_price.toFixed(2)]}),s.price_drop_amount>0&&e.jsxs("span",{className:"text-sm text-gray-500 line-through",children:["$",s.price_when_saved.toFixed(2)]})]}),s.price_drop_amount>0&&e.jsxs("p",{className:"text-sm text-green-600 font-medium mt-1",children:["Save $",s.price_drop_amount.toFixed(2)]})]}),e.jsx("div",{className:"mb-4",children:s.stock_quantity>0?e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800",children:"In Stock"}):e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800",children:"Out of Stock"})}),e.jsxs("div",{className:"flex items-center space-x-3 mb-4 text-sm",children:[e.jsxs("button",{onClick:()=>S(s.wishlist_item_id,"price",s.price_drop_alert_enabled),disabled:h.isPending,className:`flex items-center space-x-1 transition-colors ${s.price_drop_alert_enabled?"text-blue-600":"text-gray-400 hover:text-blue-600"}`,"data-testid":`price-alert-toggle-${s.wishlist_item_id}`,"aria-label":`Toggle price drop alerts for ${s.product_name}`,children:[s.price_drop_alert_enabled?e.jsx(F,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"Price alerts"})]}),e.jsxs("button",{onClick:()=>S(s.wishlist_item_id,"stock",s.back_in_stock_alert_enabled),disabled:h.isPending,className:`flex items-center space-x-1 transition-colors ${s.back_in_stock_alert_enabled?"text-blue-600":"text-gray-400 hover:text-blue-600"}`,"data-testid":`stock-alert-toggle-${s.wishlist_item_id}`,"aria-label":`Toggle back in stock alerts for ${s.product_name}`,children:[s.back_in_stock_alert_enabled?e.jsx(F,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs",children:"Stock alerts"})]})]}),e.jsxs("button",{onClick:()=>R(s.product_id,s.product_name,s.wishlist_item_id),disabled:s.stock_quantity===0||k.isPending,className:"w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2","data-testid":`add-to-cart-${s.wishlist_item_id}`,children:[e.jsx(A,{className:"w-5 h-5"}),e.jsx("span",{children:s.stock_quantity===0?"Out of Stock":"Add to Cart"})]})]})]},s.wishlist_item_id))}),!f&&!u&&n.length>0&&_==="list"&&e.jsx("div",{className:"space-y-4",children:n.map(s=>e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-all",children:e.jsxs("div",{className:"flex flex-col sm:flex-row",children:[e.jsxs("div",{className:"sm:w-48 sm:h-48 relative bg-gray-100 flex-shrink-0",children:[e.jsx("input",{type:"checkbox",checked:m.includes(s.wishlist_item_id),onChange:()=>Q(s.wishlist_item_id),className:"absolute top-3 left-3 w-5 h-5 rounded cursor-pointer z-10"}),s.price_drop_amount>0&&e.jsxs("div",{className:"absolute top-3 right-3 bg-green-600 text-white px-3 py-1 rounded-full text-xs font-medium z-10",children:["-",(s.price_drop_amount/s.price_when_saved*100).toFixed(0),"%"]}),e.jsx(w,{to:`/product/${s.product_id}`,className:"block w-full h-full",children:s.primary_image_url?e.jsx("img",{src:s.primary_image_url,alt:s.product_name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400 text-sm",children:"No image"})})})]}),e.jsx("div",{className:"flex-1 p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{className:"flex-1 mb-4 sm:mb-0",children:[e.jsx(w,{to:`/product/${s.product_id}`,children:e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2 hover:text-blue-600 transition-colors",children:s.product_name})}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.supplier_name}),e.jsx("div",{className:"mb-3",children:s.stock_quantity>0?e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800",children:"In Stock"}):e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800",children:"Out of Stock"})}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("button",{onClick:()=>S(s.wishlist_item_id,"price",s.price_drop_alert_enabled),disabled:h.isPending,className:`flex items-center space-x-1 transition-colors ${s.price_drop_alert_enabled?"text-blue-600":"text-gray-400 hover:text-blue-600"}`,"data-testid":`price-alert-toggle-${s.wishlist_item_id}`,"aria-label":`Toggle price drop alerts for ${s.product_name}`,children:[s.price_drop_alert_enabled?e.jsx(F,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:"Price alerts"})]}),e.jsxs("button",{onClick:()=>S(s.wishlist_item_id,"stock",s.back_in_stock_alert_enabled),disabled:h.isPending,className:`flex items-center space-x-1 transition-colors ${s.back_in_stock_alert_enabled?"text-blue-600":"text-gray-400 hover:text-blue-600"}`,"data-testid":`stock-alert-toggle-${s.wishlist_item_id}`,"aria-label":`Toggle back in stock alerts for ${s.product_name}`,children:[s.back_in_stock_alert_enabled?e.jsx(F,{className:"w-4 h-4"}):e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:"Stock alerts"})]})]})]}),e.jsxs("div",{className:"sm:ml-6 flex-shrink-0",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"flex items-baseline space-x-2",children:e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:["$",s.current_price.toFixed(2)]})}),s.price_drop_amount>0&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-gray-500 line-through",children:["$",s.price_when_saved.toFixed(2)]}),e.jsxs("p",{className:"text-sm text-green-600 font-medium",children:["Save $",s.price_drop_amount.toFixed(2)]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>R(s.product_id,s.product_name,s.wishlist_item_id),disabled:s.stock_quantity===0||k.isPending,className:"w-full sm:w-auto px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2","data-testid":`add-to-cart-${s.wishlist_item_id}`,children:[e.jsx(A,{className:"w-5 h-5"}),e.jsx("span",{children:s.stock_quantity===0?"Out of Stock":"Add to Cart"})]}),e.jsxs("button",{onClick:()=>L(s.wishlist_item_id,s.product_name),disabled:$.isPending,className:"w-full sm:w-auto px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all disabled:opacity-50 flex items-center justify-center space-x-2","data-testid":`remove-wishlist-${s.wishlist_item_id}`,children:[e.jsx(D,{className:"w-5 h-5"}),e.jsx("span",{children:"Remove"})]})]})]})]})})]})},s.wishlist_item_id))}),!f&&!u&&n.length>0&&e.jsx("div",{className:"mt-8 text-center text-sm text-gray-500",children:e.jsxs("p",{children:["Watching ",n.length," ",n.length===1?"product":"products"," for price changes and stock updates"]})})]})]})};export{me as default};
