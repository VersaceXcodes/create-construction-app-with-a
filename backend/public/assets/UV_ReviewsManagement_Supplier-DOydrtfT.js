import{a as Q,u as U,b as I,j as e}from"./state-vendor-__gb9IU9.js";import{e as H,r as _}from"./react-vendor-QYi6USC3.js";import{u as L,a as $}from"./index-XlgXzfNq.js";import{e as k,g as F,T as M,d as K,S as V,a0 as O,h as W,f as Y,aH as D}from"./ui-vendor-CuJPReAW.js";const G=async(b,d,c)=>{const l={supplier_id:b,status:"published",limit:c.limit.toString(),offset:c.offset.toString(),sort_by:"review_date",sort_order:"desc"};c.min_rating&&(l.min_rating=c.min_rating.toString());const p=await $.get("https://123create-construction-app-with-a.launchpulse.ai/api/reviews",{params:l,headers:{Authorization:`Bearer ${d}`}});let j=p.data.reviews||[];return c.response_needed&&(j=j.filter(f=>!f.supplier_response)),{reviews:j,total:p.data.total||0,average_rating:p.data.average_rating||0}},J=async(b,d,c)=>(await $.post(`https://123create-construction-app-with-a.launchpulse.ai/api/reviews/${b}/response`,{supplier_response:d},{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}})).data,te=()=>{const b=Q(),[d,c]=H(),l=L(s=>s.authentication_state.supplier_profile),p=L(s=>s.authentication_state.auth_token),[j,f]=_.useState(null),[N,w]=_.useState(""),[x,T]=_.useState(""),u=d.get("rating_filter")?parseInt(d.get("rating_filter")):void 0,h=d.get("response_needed")==="true",i=parseInt(d.get("page")||"1"),y=15,{data:a,isLoading:P,error:z}=U({queryKey:["supplier-reviews",l==null?void 0:l.supplier_id,u,h,i],queryFn:()=>G((l==null?void 0:l.supplier_id)||"",p||"",{min_rating:u,response_needed:h,limit:y,offset:(i-1)*y}),enabled:!!(l!=null&&l.supplier_id)&&!!p,staleTime:3e4,retry:1}),o=_.useMemo(()=>{if(!(a!=null&&a.reviews))return{total_reviews:0,average_rating:0,rating_distribution:{5:0,4:0,3:0,2:0,1:0},response_rate:0,avg_response_time_hours:0};const s=a.reviews,r={5:0,4:0,3:0,2:0,1:0};let t=0,n=0;return s.forEach(m=>{if(r[m.rating_overall]++,m.supplier_response&&m.supplier_response_date){n++;const q=new Date(m.review_date).getTime(),B=new Date(m.supplier_response_date).getTime();t+=(B-q)/(1e3*60*60)}}),{total_reviews:a.total,average_rating:a.average_rating,rating_distribution:r,response_rate:s.length>0?n/s.length*100:0,avg_response_time_hours:n>0?t/n:0}},[a]),C=I({mutationFn:s=>J(s.review_id,s.response_text,p||""),onSuccess:()=>{b.invalidateQueries({queryKey:["supplier-reviews"]}),f(null),w("")},onError:s=>{console.error("Failed to submit response:",s)}}),S=(s,r)=>{const t=new URLSearchParams(d);s==="rating_filter"&&r?t.set("rating_filter",r.toString()):s==="response_needed"&&(r?t.set("response_needed","true"):t.delete("response_needed")),t.set("page","1"),c(t)},R=s=>{const r=new URLSearchParams(d);r.set("page",s.toString()),c(r)},E=s=>{N.trim()&&C.mutate({review_id:s,response_text:N.trim()})},A=_.useMemo(()=>{if(!(a!=null&&a.reviews))return[];let s=[...a.reviews];return x&&(s=s.filter(r=>{var t,n,m;return((t=r.review_text)==null?void 0:t.toLowerCase().includes(x.toLowerCase()))||((n=r.customer_name)==null?void 0:n.toLowerCase().includes(x.toLowerCase()))||((m=r.product_name)==null?void 0:m.toLowerCase().includes(x.toLowerCase()))})),s},[a,x]),g=Math.ceil(((a==null?void 0:a.total)||0)/y),v=(s,r="md")=>{const t={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"};return e.jsx("div",{className:"flex items-center space-x-0.5",children:[1,2,3,4,5].map(n=>e.jsx(F,{className:`${t[r]} ${n<=s?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},n))})};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Reviews & Reputation"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Manage customer reviews and track your reputation performance"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Reviews"}),e.jsx(k,{className:"w-5 h-5 text-blue-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:o.total_reviews}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"All time"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Average Rating"}),e.jsx(F,{className:"w-5 h-5 text-yellow-500"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:o.average_rating.toFixed(1)}),e.jsx("div",{className:"flex",children:v(Math.round(o.average_rating),"sm")})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Out of 5.0"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Response Rate"}),e.jsx(M,{className:"w-5 h-5 text-green-600"})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:[o.response_rate.toFixed(0),"%"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:o.response_rate>=80?"Excellent":o.response_rate>=50?"Good":"Needs improvement"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Avg Response Time"}),e.jsx(K,{className:"w-5 h-5 text-purple-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:o.avg_response_time_hours>0?o.avg_response_time_hours.toFixed(1):"-"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hours"})]})]}),o.total_reviews>0&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Rating Distribution"}),e.jsx("div",{className:"space-y-3",children:[5,4,3,2,1].map(s=>{const r=o.rating_distribution[s],t=o.total_reviews>0?r/o.total_reviews*100:0;return e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1 w-20",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s}),e.jsx(F,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"})]}),e.jsx("div",{className:"flex-1 h-6 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-600 transition-all duration-300",style:{width:`${t}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-gray-600 w-16 text-right",children:[r," (",t.toFixed(0),"%)"]})]},s)})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm mb-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0 md:space-x-4",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search reviews...",value:x,onChange:s=>T(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("select",{value:u||"",onChange:s=>S("rating_filter",s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"All Ratings"}),e.jsx("option",{value:"5",children:"5 Stars Only"}),e.jsx("option",{value:"4",children:"4+ Stars"}),e.jsx("option",{value:"3",children:"3+ Stars"}),e.jsx("option",{value:"2",children:"2+ Stars"}),e.jsx("option",{value:"1",children:"1+ Stars"})]}),e.jsxs("button",{onClick:()=>S("response_needed",!h),className:`flex items-center space-x-2 px-4 py-2 rounded-lg border transition-colors ${h?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Needs Response"})]})]})]}),(u||h||x)&&e.jsxs("div",{className:"mt-4 flex items-center flex-wrap gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Active filters:"}),u&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[u,"+ Stars",e.jsx("button",{onClick:()=>S("rating_filter",""),className:"ml-2 text-blue-600 hover:text-blue-800",children:"×"})]}),h&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:["Needs Response",e.jsx("button",{onClick:()=>S("response_needed",!1),className:"ml-2 text-blue-600 hover:text-blue-800",children:"×"})]}),x&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:['Search: "',x,'"',e.jsx("button",{onClick:()=>T(""),className:"ml-2 text-blue-600 hover:text-blue-800",children:"×"})]})]})]}),P?e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-4 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading reviews..."})]}):z?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(W,{className:"w-6 h-6 text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-semibold",children:"Failed to load reviews"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:"Please try again later"})]})]})}):A.length===0?e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center",children:[e.jsx(k,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No reviews found"}),e.jsx("p",{className:"text-gray-600",children:u||h||x?"Try adjusting your filters":"Reviews from customers will appear here"})]}):e.jsx("div",{className:"space-y-4",children:A.map(s=>{var r;return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center space-x-3 mb-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:s.customer_name||"Anonymous Customer"}),s.verified_purchase&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),"Verified Purchase"]})]})}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[v(s.rating_overall),e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsx("span",{children:new Date(s.review_date).toLocaleDateString()}),s.product_name&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"•"}),e.jsx("span",{className:"text-gray-700",children:s.product_name})]})]})]}),s.supplier_response?e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Responded"}):e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-800",children:"Needs Response"})]}),(s.rating_product||s.rating_service||s.rating_delivery)&&e.jsxs("div",{className:"flex items-center space-x-6 mb-4 pb-4 border-b border-gray-100",children:[s.rating_product&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Product:"}),v(s.rating_product,"sm")]}),s.rating_service&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Service:"}),v(s.rating_service,"sm")]}),s.rating_delivery&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Delivery:"}),v(s.rating_delivery,"sm")]})]}),s.review_text&&e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-gray-700 leading-relaxed",children:s.review_text})}),s.photos&&s.photos.length>0&&e.jsx("div",{className:"flex space-x-2 mb-4",children:s.photos.map((t,n)=>e.jsx("img",{src:t,alt:`Review photo ${n+1}`,className:"w-20 h-20 object-cover rounded-lg border border-gray-200"},n))}),s.helpful_votes>0&&e.jsx("div",{className:"mb-4",children:e.jsxs("span",{className:"text-sm text-gray-600",children:[s.helpful_votes," ",s.helpful_votes===1?"customer":"customers"," found this helpful"]})}),s.supplier_response?e.jsx("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-4 mt-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-sm font-semibold",children:((r=l==null?void 0:l.business_name)==null?void 0:r.charAt(0))||"S"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:(l==null?void 0:l.business_name)||"Your Business"}),e.jsx("span",{className:"text-xs text-gray-500",children:s.supplier_response_date?new Date(s.supplier_response_date).toLocaleDateString():""})]}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:s.supplier_response})]})]})}):j===s.review_id?e.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Your Response"}),e.jsx("textarea",{value:N,onChange:t=>w(t.target.value),placeholder:"Write a professional response to this review...",rows:4,maxLength:1e3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[N.length,"/1000 characters"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>{f(null),w("")},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>E(s.review_id),disabled:!N.trim()||C.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:C.isPending?e.jsxs("span",{className:"flex items-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Submitting..."]}):"Submit Response"})]})]})]}):e.jsxs("div",{className:"mt-4 flex items-center space-x-3",children:[e.jsxs("button",{onClick:()=>{f(s.review_id),w("")},className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{children:"Respond to Review"})]}),e.jsxs("button",{disabled:!0,className:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-gray-400 bg-gray-50 border border-gray-200 rounded-lg cursor-not-allowed",title:"Flag for moderation (coming soon)",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{children:"Flag"})]})]})]},s.review_id)})}),g>1&&e.jsxs("div",{className:"flex items-center justify-between bg-white rounded-xl border border-gray-200 px-6 py-4 shadow-sm",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(i-1)*y+1," to ",Math.min(i*y,(a==null?void 0:a.total)||0)," of ",(a==null?void 0:a.total)||0," reviews"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>R(i-1),disabled:i===1,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,g)},(s,r)=>{let t;return g<=5||i<=3?t=r+1:i>=g-2?t=g-4+r:t=i-2+r,e.jsx("button",{onClick:()=>R(t),className:`px-3 py-1 text-sm font-medium rounded-lg transition-colors ${t===i?"bg-blue-600 text-white":"text-gray-700 hover:bg-gray-100"}`,children:t},t)})}),e.jsx("button",{onClick:()=>R(i+1),disabled:i===g,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]}),e.jsxs("div",{className:"mt-8 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center",children:[e.jsx(M,{className:"w-5 h-5 text-blue-600 mr-2"}),"Tips for Managing Reviews"]}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-blue-600 mr-2",children:"•"}),e.jsx("span",{children:"Respond to all reviews within 24 hours to show customers you care"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-blue-600 mr-2",children:"•"}),e.jsx("span",{children:"Thank customers for positive reviews and address concerns in negative ones"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-blue-600 mr-2",children:"•"}),e.jsx("span",{children:"Keep responses professional, concise, and solution-focused"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-blue-600 mr-2",children:"•"}),e.jsx("span",{children:"Use reviews as feedback to improve your products and services"})]})]})]})]})})})};export{te as default};
