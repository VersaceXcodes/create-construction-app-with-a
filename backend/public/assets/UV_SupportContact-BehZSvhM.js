import{u as O,j as e}from"./state-vendor-__gb9IU9.js";import{r as h,L as m}from"./react-vendor-QYi6USC3.js";import{u as F,a as L}from"./index-DVkU_ME6.js";import{f as S,F as C,o as q,p as I,e as G,h as p,X as P,a5 as T,at as z}from"./ui-vendor-CuJPReAW.js";const V=async l=>(await L.get("https://123create-construction-app-with-a.launchpulse.ai/api/orders",{headers:{Authorization:`Bearer ${l}`},params:{limit:10,sort_by:"order_date",sort_order:"desc"}})).data.orders||[],Y=async(l,u,r)=>(await L.post("https://123create-construction-app-with-a.launchpulse.ai/api/support/tickets",{user_id:u,order_id:l.order_id,issue_category:l.issue_category,subject:l.subject,message:l.message,attachments:l.attachments,priority:l.priority},{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}})).data,W=()=>{const l=F(s=>s.authentication_state.current_user),u=F(s=>s.authentication_state.auth_token),[r,i]=h.useState({issue_category:"",subject:"",message:"",order_id:null,attachments:[],priority:"normal"}),[n,f]=h.useState({issue_category:null,subject:null,message:null}),[o,x]=h.useState({is_submitting:!1,submission_success:!1,ticket_id:null,error_message:null}),[N,v]=h.useState([]),[B,j]=h.useState({}),[b,w]=h.useState(!1),{data:_=[],isLoading:$}=O({queryKey:["userOrders",l==null?void 0:l.user_id],queryFn:()=>V(u||""),enabled:!!u&&!!(l!=null&&l.user_id),staleTime:5*60*1e3}),y=s=>{f(t=>({...t,[s]:null}))},M=()=>{const s={issue_category:null,subject:null,message:null};let t=!0;return r.issue_category||(s.issue_category="Please select an issue category",t=!1),r.subject.trim()?r.subject.length>255&&(s.subject="Subject must be less than 255 characters",t=!1):(s.subject="Subject is required",t=!1),r.message.trim()?r.message.trim().length<50?(s.message="Message must be at least 50 characters",t=!1):r.message.length>5e3&&(s.message="Message must be less than 5000 characters",t=!1):(s.message="Message is required",t=!1),f(s),t},U=async s=>{const t=Array.from(s.target.files||[]);if(r.attachments.length+t.length>5){alert("Maximum 5 attachments allowed");return}const d=[];for(const a of t){if(a.size>5*1024*1024){alert(`${a.name} exceeds 5MB limit`);continue}if(!["image/jpeg","image/png","application/pdf"].includes(a.type)){alert(`${a.name} has invalid type. Only JPG, PNG, and PDF allowed`);continue}d.push(a)}if(d.length!==0){w(!0),v(d);try{const a=[];for(const c of d){j(g=>({...g,[c.name]:0})),await new Promise(g=>setTimeout(g,1e3));const E=`https://cdn.buildeasy.com/support/${Date.now()}_${c.name}`;a.push(E),j(g=>({...g,[c.name]:100}))}i(c=>({...c,attachments:[...c.attachments,...a]})),v([]),j({})}catch(a){console.error("Upload error:",a),alert("Failed to upload files. Please try again.")}finally{w(!1)}}},A=s=>{i(t=>({...t,attachments:t.attachments.filter((d,a)=>a!==s)}))},D=async s=>{var t,d;if(s.preventDefault(),!!M()){if(!(l!=null&&l.user_id)||!u){x(a=>({...a,error_message:"Authentication required. Please log in again."}));return}x({is_submitting:!0,submission_success:!1,ticket_id:null,error_message:null});try{const a=await Y(r,l.user_id,u);x({is_submitting:!1,submission_success:!0,ticket_id:a.ticket_id,error_message:null}),i({issue_category:"",subject:"",message:"",order_id:null,attachments:[],priority:"normal"})}catch(a){console.error("Ticket submission error:",a);const c=((d=(t=a.response)==null?void 0:t.data)==null?void 0:d.message)||a.message||"Failed to submit support ticket. Please try again.";x({is_submitting:!1,submission_success:!1,ticket_id:null,error_message:c})}}},k=()=>{i({issue_category:"",subject:"",message:"",order_id:null,attachments:[],priority:"normal"}),f({issue_category:null,subject:null,message:null}),x({is_submitting:!1,submission_success:!1,ticket_id:null,error_message:null})};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(m,{to:"/dashboard",className:"inline-flex items-center text-blue-600 hover:text-blue-700 font-medium transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Dashboard"]})}),o.submission_success&&o.ticket_id&&e.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden mb-8",children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4",children:e.jsx(S,{className:"w-10 h-10 text-green-600"})}),e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Support Ticket Created! ðŸŽ‰"}),e.jsxs("p",{className:"text-lg text-gray-600 mb-6",children:["Your support ticket ",e.jsxs("span",{className:"font-semibold text-blue-600",children:["#",o.ticket_id]})," has been created successfully."]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-6 mb-6 text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"What happens next?"}),e.jsxs("ul",{className:"space-y-2 text-gray-700",children:[e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-blue-600 mr-2",children:"âœ“"}),e.jsx("span",{children:"You'll receive a confirmation email within a few minutes"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-blue-600 mr-2",children:"â†’"}),e.jsx("span",{children:"Our support team will review your ticket (within 24 hours)"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-blue-600 mr-2",children:"â†’"}),e.jsx("span",{children:"You'll receive updates via email and in-app notifications"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs(m,{to:"/support/tickets",className:"inline-flex items-center justify-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors shadow-lg hover:shadow-xl",children:[e.jsx(C,{className:"w-5 h-5 mr-2"}),"View My Tickets"]}),e.jsx("button",{onClick:k,className:"inline-flex items-center justify-center px-6 py-3 bg-white text-gray-700 font-medium rounded-lg border-2 border-gray-200 hover:bg-gray-50 transition-colors",children:"Submit Another Ticket"})]})]})}),!o.submission_success&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 px-8 py-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Contact Support"}),e.jsx("p",{className:"text-blue-100",children:"We're here to help. Fill out the form below and we'll get back to you within 24 hours."})]}),e.jsxs("div",{className:"px-8 py-6 bg-gray-50 border-b border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3 font-medium",children:"Need immediate assistance?"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("a",{href:"tel:1-800-BUILD-EZ",className:"inline-flex items-center text-blue-600 hover:text-blue-700 text-sm font-medium",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"1-800-BUILD-EZ"]}),e.jsxs("a",{href:"mailto:support@buildeasy.com",className:"inline-flex items-center text-blue-600 hover:text-blue-700 text-sm font-medium",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"support@buildeasy.com"]}),e.jsxs("button",{type:"button",className:"inline-flex items-center text-blue-600 hover:text-blue-700 text-sm font-medium",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Live Chat"]})]})]})]}),o.error_message&&e.jsx("div",{className:"bg-red-50 border-2 border-red-200 rounded-lg p-4 mb-6",role:"alert","aria-live":"polite",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(p,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-800 mb-1",children:"Error Submitting Ticket"}),e.jsx("p",{className:"text-sm text-red-700",children:o.error_message})]}),e.jsx("button",{onClick:()=>x(s=>({...s,error_message:null})),className:"text-red-600 hover:text-red-700",children:e.jsx(P,{className:"w-5 h-5"})})]})}),e.jsx("form",{onSubmit:D,className:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden",children:e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"issue_category",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Issue Category ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{id:"issue_category",value:r.issue_category,onChange:s=>{i(t=>({...t,issue_category:s.target.value})),y("issue_category")},className:`w-full px-4 py-3 rounded-lg border-2 ${n.issue_category?"border-red-300 focus:border-red-500 focus:ring-red-100":"border-gray-200 focus:border-blue-500 focus:ring-blue-100"} focus:ring-4 focus:outline-none transition-all`,children:[e.jsx("option",{value:"",children:"Select an issue category"}),e.jsx("option",{value:"delivery",children:"Delivery Issue"}),e.jsx("option",{value:"product_quality",children:"Product Quality"}),e.jsx("option",{value:"payment",children:"Payment or Billing"}),e.jsx("option",{value:"account",children:"Account Issue"}),e.jsx("option",{value:"technical",children:"Technical Problem"}),e.jsx("option",{value:"other",children:"Other"})]}),n.issue_category&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center",role:"alert",children:[e.jsx(p,{className:"w-4 h-4 mr-1"}),n.issue_category]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"order_id",className:"block text-sm font-semibold text-gray-900 mb-2",children:"Related Order (Optional)"}),$?e.jsxs("div",{className:"flex items-center text-gray-500 text-sm py-3",children:[e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}),"Loading your orders..."]}):_.length>0?e.jsxs("select",{id:"order_id",value:r.order_id||"",onChange:s=>i(t=>({...t,order_id:s.target.value||null})),className:"w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 focus:outline-none transition-all",children:[e.jsx("option",{value:"",children:"Not related to a specific order"}),_.map(s=>e.jsxs("option",{value:s.order_id,children:[s.order_number," - ",new Date(s.order_date).toLocaleDateString()," - $",Number(s.total_amount).toFixed(2)]},s.order_id))]}):e.jsx("p",{className:"text-sm text-gray-500 py-3",children:"No recent orders found"}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"If your issue relates to a specific order, select it here for faster resolution"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"subject",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Subject ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{id:"subject",type:"text",value:r.subject,onChange:s=>{i(t=>({...t,subject:s.target.value})),y("subject")},placeholder:"Brief summary of your issue",maxLength:255,className:`w-full px-4 py-3 rounded-lg border-2 ${n.subject?"border-red-300 focus:border-red-500 focus:ring-red-100":"border-gray-200 focus:border-blue-500 focus:ring-blue-100"} focus:ring-4 focus:outline-none transition-all`}),e.jsxs("div",{className:"mt-2 flex justify-between items-center",children:[n.subject?e.jsxs("p",{className:"text-sm text-red-600 flex items-center",role:"alert",children:[e.jsx(p,{className:"w-4 h-4 mr-1"}),n.subject]}):e.jsx("p",{className:"text-xs text-gray-500",children:'Example: "Damaged product in Order #12345"'}),e.jsxs("span",{className:"text-xs text-gray-400",children:[r.subject.length,"/255"]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"message",className:"block text-sm font-semibold text-gray-900 mb-2",children:["Detailed Description ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("textarea",{id:"message",value:r.message,onChange:s=>{i(t=>({...t,message:s.target.value})),y("message")},placeholder:"Please describe your issue in detail. Include relevant information like dates, product names, or error messages.",rows:8,maxLength:5e3,className:`w-full px-4 py-3 rounded-lg border-2 ${n.message?"border-red-300 focus:border-red-500 focus:ring-red-100":"border-gray-200 focus:border-blue-500 focus:ring-blue-100"} focus:ring-4 focus:outline-none transition-all resize-none leading-relaxed`}),e.jsxs("div",{className:"mt-2 flex justify-between items-start",children:[e.jsx("div",{className:"flex-1",children:n.message?e.jsxs("p",{className:"text-sm text-red-600 flex items-center",role:"alert",children:[e.jsx(p,{className:"w-4 h-4 mr-1"}),n.message]}):e.jsx("p",{className:"text-xs text-gray-500",children:"Minimum 50 characters. Be as detailed as possible to help us assist you better."})}),e.jsxs("span",{className:`text-xs ml-4 flex-shrink-0 ${r.message.trim().length<50?"text-red-500":r.message.length>4500?"text-amber-500":"text-gray-400"}`,children:[r.message.length,"/5000"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Attachments (Optional)"}),r.attachments.length<5&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{htmlFor:"file_upload",className:`flex items-center justify-center px-6 py-4 border-2 border-dashed rounded-lg cursor-pointer transition-all ${b?"border-gray-300 bg-gray-50 cursor-not-allowed":"border-blue-300 bg-blue-50 hover:bg-blue-100 hover:border-blue-400"}`,children:[e.jsx(z,{className:"w-5 h-5 text-blue-600 mr-2"}),e.jsx("span",{className:"text-sm font-medium text-blue-600",children:b?"Uploading...":"Upload Files (JPG, PNG, PDF)"})]}),e.jsx("input",{id:"file_upload",type:"file",multiple:!0,accept:"image/jpeg,image/png,application/pdf",onChange:U,disabled:b,className:"hidden"}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Maximum 5 files, 5MB each. Supported: JPG, PNG, PDF"})]}),N.length>0&&e.jsx("div",{className:"space-y-2 mb-4",children:N.map(s=>e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 truncate flex-1",children:s.name}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:[(s.size/1024).toFixed(0),"KB"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${B[s.name]||0}%`}})})]},s.name))}),r.attachments.length>0&&e.jsx("div",{className:"space-y-2",children:r.attachments.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between bg-green-50 rounded-lg p-3 border border-green-200",children:[e.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[e.jsx(S,{className:"w-4 h-4 text-green-600 mr-2 flex-shrink-0"}),e.jsxs("span",{className:"text-sm text-gray-700 truncate",children:["Attachment ",t+1]})]}),e.jsx("button",{type:"button",onClick:()=>A(t),className:"ml-3 text-red-600 hover:text-red-700 transition-colors flex-shrink-0",children:e.jsx(P,{className:"w-5 h-5"})})]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"priority",className:"block text-sm font-semibold text-gray-900 mb-2",children:"Priority Level"}),e.jsxs("select",{id:"priority",value:r.priority,onChange:s=>i(t=>({...t,priority:s.target.value})),className:"w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 focus:outline-none transition-all",children:[e.jsx("option",{value:"low",children:"Low - General inquiry"}),e.jsx("option",{value:"normal",children:"Normal - Standard support"}),e.jsx("option",{value:"high",children:"High - Urgent issue"}),e.jsx("option",{value:"urgent",children:"Urgent - Critical problem"})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"High and Urgent priorities receive faster response times"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"submit",disabled:o.is_submitting||b,className:"flex-1 inline-flex items-center justify-center px-8 py-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg hover:shadow-xl",children:o.is_submitting?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-5 h-5 mr-2 animate-spin"}),"Submitting Ticket..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-5 h-5 mr-2"}),"Submit Support Ticket"]})}),e.jsx("button",{type:"button",onClick:k,disabled:o.is_submitting,className:"sm:w-auto px-8 py-4 bg-white text-gray-700 font-medium rounded-lg border-2 border-gray-200 hover:bg-gray-50 focus:outline-none focus:ring-4 focus:ring-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:"Clear Form"})]})]})}),e.jsx("div",{className:"mt-8 bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden",children:e.jsxs("div",{className:"p-8",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Before submitting a ticket"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-gray-700 leading-relaxed",children:["You might find answers faster in our"," ",e.jsx(m,{to:"/help",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Knowledge Base"}),". Common topics include:"]}),e.jsxs("ul",{className:"space-y-2 ml-6",children:[e.jsx("li",{className:"text-gray-700",children:e.jsx(m,{to:"/help/article/tracking-orders",className:"text-blue-600 hover:text-blue-700",children:"â€¢ How to track your order"})}),e.jsx("li",{className:"text-gray-700",children:e.jsx(m,{to:"/help/article/returns",className:"text-blue-600 hover:text-blue-700",children:"â€¢ Return and refund policies"})}),e.jsx("li",{className:"text-gray-700",children:e.jsx(m,{to:"/help/article/payment",className:"text-blue-600 hover:text-blue-700",children:"â€¢ Payment methods and issues"})}),e.jsx("li",{className:"text-gray-700",children:e.jsx(m,{to:"/help/article/account",className:"text-blue-600 hover:text-blue-700",children:"â€¢ Managing your account"})})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"ðŸ’¡ Tip:"})," For order-specific issues, you can also report directly from the"," ",e.jsx(m,{to:"/orders",className:"underline font-medium",children:"order details page"}),"."]})})]})})]})]})})})};export{W as default};
