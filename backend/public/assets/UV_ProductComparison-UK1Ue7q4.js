import{a as ee,u as te,b as se,j as e}from"./state-vendor-__gb9IU9.js";import{u as ae,e as re,r as o,L as u}from"./react-vendor-QYi6USC3.js";import{u as S,a as R}from"./index-4570EpHZ.js";import{h,a8 as ie,w as ne,c as A,ab as le,ac as ce,X as M,Y as b,W as oe,K as de}from"./ui-vendor-CuJPReAW.js";const me=async(d,x)=>{const j="https://urls-washer-articles-luke.trycloudflare.com",N={"Content-Type":"application/json"};return x&&(N.Authorization=`Bearer ${x}`),(await R.get(`${j}/api/products/compare`,{params:{product_ids:d.join(",")},headers:N})).data.filter(w=>w!==null)},ue=async d=>(await R.post("/cart/items",{product_id:d,quantity:1})).data,ge=()=>{const d=ae(),x=ee(),[j,N]=re(),F=S(t=>t.authentication_state.auth_token),w=S(t=>t.authentication_state.authentication_status.is_authenticated),z=S(t=>t.fetch_cart),n=o.useMemo(()=>{var t;return((t=j.get("product_ids"))==null?void 0:t.split(",").filter(r=>r.trim()))||[]},[j]),[p,B]=o.useState(!1),[l,v]=o.useState(0),[E,T]=o.useState(!1),k=5;o.useEffect(()=>{w||d("/login?redirect_url=/compare")},[w,d]);const{data:a=[],isLoading:I,error:O,refetch:L}=te({queryKey:["comparison-products",n.join(",")],queryFn:()=>me(n,F),enabled:n.length>=2&&n.length<=k,staleTime:2*60*1e3,select:t=>t.map(r=>({...r,price_per_unit:Number(r.price_per_unit||0),stock_quantity:Number(r.stock_quantity||0),rating_average:Number(r.rating_average||0)}))}),m=se({mutationFn:t=>ue(t),onSuccess:()=>{z(),x.invalidateQueries({queryKey:["cart"]}),x.invalidateQueries({queryKey:["cart-summary"]})}}),C=o.useMemo(()=>{if(!a)return[];const t=a.map(r=>r.product_id);return n.filter(r=>!t.includes(r))},[n,a]),P=o.useMemo(()=>{if(a.length===0)return[];const t=[{attribute_key:"product_name",attribute_label:"Product Name",values:a.map(s=>s.product_name),has_differences:new Set(a.map(s=>s.product_name)).size>1},{attribute_key:"price_per_unit",attribute_label:"Price",values:a.map(s=>s.price_per_unit),has_differences:new Set(a.map(s=>s.price_per_unit)).size>1},{attribute_key:"supplier",attribute_label:"Supplier",values:a.map(s=>s.business_name||"Unknown"),has_differences:new Set(a.map(s=>s.business_name)).size>1},{attribute_key:"rating",attribute_label:"Rating",values:a.map(s=>s.rating_average||0),has_differences:new Set(a.map(s=>s.rating_average)).size>1},{attribute_key:"stock_quantity",attribute_label:"In Stock",values:a.map(s=>s.stock_quantity>0?"Yes":"No"),has_differences:new Set(a.map(s=>s.stock_quantity>0)).size>1},{attribute_key:"brand",attribute_label:"Brand",values:a.map(s=>s.brand||"N/A"),has_differences:new Set(a.map(s=>s.brand)).size>1},{attribute_key:"sku",attribute_label:"SKU",values:a.map(s=>s.sku),has_differences:new Set(a.map(s=>s.sku)).size>1},{attribute_key:"delivery_time",attribute_label:"Delivery Time",values:a.map(s=>s.handling_time_days?`${s.handling_time_days} days`:"N/A"),has_differences:new Set(a.map(s=>s.handling_time_days)).size>1}],r=new Set;return a.forEach(s=>{s.specifications&&Object.keys(s.specifications).forEach(i=>r.add(i))}),r.forEach(s=>{const i=a.map(g=>{var _,y;return((y=(_=g.specifications)==null?void 0:_[s])==null?void 0:y.toString())||"N/A"});t.push({attribute_key:`spec_${s}`,attribute_label:s.replace(/_/g," ").replace(/\b\w/g,g=>g.toUpperCase()),values:i,has_differences:new Set(i).size>1})}),t},[a]),$=o.useMemo(()=>p?P.filter(t=>t.has_differences):P,[P,p]),c=o.useMemo(()=>{if(a.length===0)return{};const t=a.map(f=>f.price_per_unit),r=Math.min(...t),s=t.indexOf(r),i=a.map(f=>f.handling_time_days||999),g=Math.min(...i),_=i.indexOf(g),y=a.map(f=>f.rating_average||0),J=Math.max(...y),Z=y.indexOf(J);return{bestPrice:s,fastestDelivery:_,highestRated:Z}},[a]),D=t=>{const r=n.filter(s=>s!==t);if(r.length<2){d("/products");return}N({product_ids:r.join(",")})},q=async t=>{try{await m.mutateAsync(t.product_id)}catch(r){console.error("Failed to add to cart:",r)}},V=async()=>{try{for(const t of a)await m.mutateAsync(t.product_id)}catch(t){console.error("Failed to add all to cart:",t)}},K=()=>{const t=window.location.href;navigator.clipboard.writeText(t).then(()=>{T(!0),setTimeout(()=>T(!1),3e3)})},U=()=>{window.print()},Q=()=>{B(!p)},Y=()=>{v(t=>t<a.length-1?t+1:t)},G=()=>{v(t=>t>0?t-1:t)};if(n.length===0)return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx(h,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"No Products Selected"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Select products from the catalog to compare them side-by-side."}),e.jsx(u,{to:"/products",className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Browse Products"})]})})});if(n.length===1)return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx(h,{className:"w-16 h-16 text-amber-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Add More Products to Compare"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"You need at least 2 products to make a comparison."}),e.jsx(u,{to:"/products",className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Add More Products"})]})})});if(n.length>k)return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx(h,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Too Many Products"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["You can compare up to ",k," products at once."]}),e.jsx(u,{to:"/products",className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Back to Products"})]})})});if(I)return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-4 border-blue-600"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading comparison..."})]})})})})});if(O)return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx(h,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Failed to Load Products"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"There was an error loading the comparison data."}),e.jsxs("button",{onClick:()=>L(),className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Try Again"]})]})})});const H=()=>C.length===0?null:e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(h,{className:"w-5 h-5 text-amber-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-amber-900 mb-1",children:"Some Products Not Found"}),e.jsxs("p",{className:"text-sm text-amber-700",children:[C.length," product",C.length>1?"s":""," could not be loaded. Showing comparison with available products only."]})]})]})}),W=()=>e.jsx("div",{className:"overflow-x-auto bg-white rounded-xl shadow-lg border border-gray-200",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-200",children:[e.jsx("th",{className:"sticky left-0 z-10 bg-gray-50 px-6 py-4 text-left text-sm font-semibold text-gray-900 min-w-[200px]",children:"Attributes"}),a.map((t,r)=>e.jsx("th",{className:"px-6 py-4 min-w-[280px]",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>D(t.product_id),className:"absolute -top-2 -right-2 p-1.5 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors","aria-label":"Remove product from comparison",children:e.jsx(M,{className:"w-4 h-4"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-1 justify-center min-h-[24px]",children:[c.bestPrice===r&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(b,{className:"w-3 h-3 mr-1"}),"Best Price"]}),c.fastestDelivery===r&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(b,{className:"w-3 h-3 mr-1"}),"Fastest"]}),c.highestRated===r&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(b,{className:"w-3 h-3 mr-1"}),"Top Rated"]})]}),e.jsx("div",{className:"w-full aspect-square bg-gray-100 rounded-lg overflow-hidden",children:e.jsx("img",{src:t.primary_image_url||"https://via.placeholder.com/280",alt:t.product_name,className:"w-full h-full object-cover"})})]})]})},t.product_id))]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[$.map((t,r)=>e.jsxs("tr",{className:r%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"sticky left-0 z-10 px-6 py-4 text-sm font-medium text-gray-900 bg-inherit",children:t.attribute_label}),t.values.map((s,i)=>e.jsx("td",{className:`px-6 py-4 text-sm text-gray-700 ${t.attribute_key==="price_per_unit"&&c.bestPrice===i?"bg-green-50 font-semibold":t.attribute_key==="delivery_time"&&c.fastestDelivery===i?"bg-blue-50 font-semibold":t.attribute_key==="rating"&&c.highestRated===i?"bg-yellow-50 font-semibold":""}`,children:t.attribute_key==="price_per_unit"?`$${Number(s).toFixed(2)}`:t.attribute_key==="rating"?`${Number(s).toFixed(1)} ★`:s},i))]},t.attribute_key)),e.jsxs("tr",{className:"bg-white",children:[e.jsx("td",{className:"sticky left-0 z-10 px-6 py-4 text-sm font-medium text-gray-900 bg-white",children:"Actions"}),a.map(t=>e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>q(t),disabled:m.isPending||t.stock_quantity===0,className:"w-full flex items-center justify-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:m.isPending?"Adding...":e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Add to Cart"]})}),e.jsx(u,{to:`/product/${t.product_id}`,className:"block w-full text-center px-4 py-2 bg-gray-100 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-200 transition-colors",children:"View Details"})]})},t.product_id))]})]})]})}),X=()=>{const t=a[l];return t?e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-gray-50 border-b border-gray-200 px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:G,disabled:l===0,className:"p-2 text-gray-600 hover:text-gray-900 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(oe,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex items-center space-x-2",children:a.map((r,s)=>e.jsx("button",{onClick:()=>v(s),className:`w-2 h-2 rounded-full transition-colors ${s===l?"bg-blue-600":"bg-gray-300"}`,"aria-label":`View product ${s+1}`},s))}),e.jsx("button",{onClick:Y,disabled:l===a.length-1,className:"p-2 text-gray-600 hover:text-gray-900 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(de,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[c.bestPrice===l&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(b,{className:"w-3 h-3 mr-1"}),"Best Price"]}),c.fastestDelivery===l&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(b,{className:"w-3 h-3 mr-1"}),"Fastest Delivery"]}),c.highestRated===l&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(b,{className:"w-3 h-3 mr-1"}),"Top Rated"]})]}),e.jsx("div",{className:"w-full aspect-square bg-gray-100 rounded-lg overflow-hidden mb-4",children:e.jsx("img",{src:t.primary_image_url||"https://via.placeholder.com/400",alt:t.product_name,className:"w-full h-full object-cover"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:t.product_name}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600 mb-4",children:["$",Number(t.price_per_unit||0).toFixed(2)]}),e.jsx("div",{className:"space-y-3 mb-6",children:$.map(r=>e.jsxs("div",{className:"flex justify-between py-2 border-b border-gray-100",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:r.attribute_label}),e.jsx("span",{className:"text-sm text-gray-900",children:r.attribute_key==="price_per_unit"?`$${Number(r.values[l]).toFixed(2)}`:r.attribute_key==="rating"?`${Number(r.values[l]).toFixed(1)} ★`:r.values[l]})]},r.attribute_key))}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>q(t),disabled:m.isPending||t.stock_quantity===0,className:"w-full flex items-center justify-center px-4 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:m.isPending?"Adding...":e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),"Add to Cart"]})}),e.jsx(u,{to:`/product/${t.product_id}`,className:"block w-full text-center px-4 py-3 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200 transition-colors",children:"View Full Details"}),e.jsxs("button",{onClick:()=>D(t.product_id),className:"w-full flex items-center justify-center px-4 py-3 border border-red-200 text-red-600 font-medium rounded-lg hover:bg-red-50 transition-colors",children:[e.jsx(M,{className:"w-5 h-5 mr-2"}),"Remove from Comparison"]})]})]})]}):null};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Compare Products"}),e.jsxs("p",{className:"text-gray-600",children:["Comparing ",a.length," product",a.length!==1?"s":""]})]}),e.jsxs(u,{to:"/products",className:"inline-flex items-center px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-sm font-medium",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Add More Products"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("button",{onClick:Q,className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${p?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:p?"Show All Attributes":"Highlight Differences Only"}),e.jsxs("button",{onClick:V,disabled:m.isPending,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(A,{className:"w-4 h-4 inline mr-2"}),"Add All to Cart"]}),e.jsxs("button",{onClick:K,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-sm font-medium",children:[e.jsx(le,{className:"w-4 h-4 inline mr-2"}),E?"Link Copied!":"Share"]}),e.jsxs("button",{onClick:U,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-sm font-medium hidden md:block",children:[e.jsx(ce,{className:"w-4 h-4 inline mr-2"}),"Print"]})]})]}),e.jsx(H,{}),a.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 p-12 text-center",children:[e.jsx(h,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Products to Compare"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"The selected products could not be loaded."}),e.jsx(u,{to:"/products",className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Browse Products"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block",children:e.jsx(W,{})}),e.jsx("div",{className:"block md:hidden",children:e.jsx(X,{})})]}),a.length>0&&e.jsxs("div",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Comparison Tips"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"• Green highlights indicate the best price among compared products"}),e.jsx("li",{children:"• Blue highlights show the fastest delivery time"}),e.jsx("li",{children:"• Gold highlights indicate the highest-rated product"}),e.jsx("li",{children:'• Use "Highlight Differences Only" to focus on key distinctions'}),e.jsx("li",{children:"• Add products to your cart directly from the comparison"})]})]})]})})})};export{ge as default};
