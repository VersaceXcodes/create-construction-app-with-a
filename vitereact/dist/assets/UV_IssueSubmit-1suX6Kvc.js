import{u as A,j as e}from"./state-vendor-__gb9IU9.js";import{u as q,e as G,r as g}from"./react-vendor-QYi6USC3.js";import{u as V,a as w}from"./index-C8z-Yyaa.js";import"./ui-vendor-CuJPReAW.js";const H=async(o,u)=>{const l=await w.get(`https://123create-construction-app-with-a.launchpulse.ai/api/orders/${o}`,{headers:{Authorization:`Bearer ${u}`}});return{order:{order_id:l.data.order.order_id,order_number:l.data.order.order_number,order_date:l.data.order.order_date,status:l.data.order.status,total_amount:l.data.order.total_amount},items:l.data.items.map(d=>({order_item_id:d.order_item_id,product_id:d.product_id,product_name:d.product_name,sku:d.sku,quantity:d.quantity,supplier_id:d.supplier_id}))}},J=async(o,u)=>(await w.post("https://123create-construction-app-with-a.launchpulse.ai/api/uploads/request-url",{file_type:o.type,file_size:o.size,upload_context:"issue"},{headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}})).data,Q=async(o,u)=>{await w.put(u,o,{headers:{"Content-Type":o.type}})},K=async(o,u)=>(await w.post("https://123create-construction-app-with-a.launchpulse.ai/api/issues",o,{headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}})).data,se=()=>{const o=q(),[u]=G(),l=V(s=>s.authentication_state.auth_token),d=u.get("order_id"),[r,f]=g.useState({order_id:d||null,issue_type:"",affected_items:[],description:"",evidence_photos:[],desired_resolution:""}),[m,j]=g.useState({}),[C,k]=g.useState(!1),[$,P]=g.useState(null),[h,S]=g.useState([]),[I,_]=g.useState({}),[L,v]=g.useState([]),{data:i,isLoading:M}=A({queryKey:["order-context",d],queryFn:()=>H(d,l),enabled:!!d&&!!l,staleTime:5*60*1e3,retry:1});g.useEffect(()=>{i&&!r.order_id&&f(s=>({...s,order_id:i.order.order_id}))},[i,r.order_id]);const F=s=>{f(t=>({...t,issue_type:s})),j(t=>({...t,issue_type:void 0}))},R=s=>{f(t=>{const p=t.affected_items.includes(s);return{...t,affected_items:p?t.affected_items.filter(x=>x!==s):[...t.affected_items,s]}}),j(t=>({...t,affected_items:void 0}))},z=s=>{f(t=>({...t,description:s})),j(t=>({...t,description:void 0}))},B=s=>{f(t=>({...t,desired_resolution:s})),j(t=>({...t,desired_resolution:void 0}))},E=async s=>{const t=s.target.files;if(!t||t.length===0)return;v([]);const p=r.evidence_photos.length,x=t.length;if(p+x>10){v(["Maximum 10 photos allowed"]);return}try{const y=[];for(let b=0;b<t.length;b++){const N=t[b],n=N.name;if(!["image/jpeg","image/png","image/webp"].includes(N.type)){v(a=>[...a,`${n}: Invalid file type. Only JPG, PNG, WEBP allowed.`]);continue}if(N.size>5*1024*1024){v(a=>[...a,`${n}: File too large. Maximum 5MB.`]);continue}S(a=>[...a,n]),_(a=>({...a,[n]:0}));try{const a=await J(N,l);_(c=>({...c,[n]:30})),await Q(N,a.upload_url),_(c=>({...c,[n]:100})),y.push(a.cdn_url)}catch(a){v(c=>[...c,`${n}: Upload failed`]),console.error(`Upload error for ${n}:`,a)}finally{S(a=>a.filter(c=>c!==n)),setTimeout(()=>{_(a=>{const c={...a};return delete c[n],c})},1e3)}}y.length>0&&f(b=>({...b,evidence_photos:[...b.evidence_photos,...y]}))}catch(y){v(b=>[...b,"Upload failed. Please try again."]),console.error("Photo upload error:",y)}},U=s=>{f(t=>({...t,evidence_photos:t.evidence_photos.filter(p=>p!==s)}))},D=()=>{const s={};return r.issue_type||(s.issue_type="Please select an issue type"),r.order_id?r.affected_items.length===0&&(s.affected_items="Please select at least one affected item"):s.affected_items="No order selected",(!r.description||r.description.trim().length<50)&&(s.description="Please provide at least 50 characters describing the issue"),r.description&&r.description.length>2e3&&(s.description="Description must be less than 2000 characters"),r.desired_resolution||(s.desired_resolution="Please select your desired resolution"),j(s),Object.keys(s).length===0},T=async s=>{var t,p;if(s.preventDefault(),P(null),!!D()){if(!r.order_id){P("No order selected. Please select an order to report an issue.");return}k(!0);try{const x={order_id:r.order_id,issue_type:r.issue_type,affected_items:r.affected_items,description:r.description,evidence_photos:r.evidence_photos,desired_resolution:r.desired_resolution},y=await K(x,l);o(`/issues/${y.issue_id}`)}catch(x){console.error("Issue submission error:",x),P(((p=(t=x.response)==null?void 0:t.data)==null?void 0:p.message)||"Failed to submit issue. Please try again.")}finally{k(!1)}}},O=[{value:"late_delivery",label:"Late Delivery",icon:"ðŸ•"},{value:"wrong_item",label:"Wrong Item Delivered",icon:"ðŸ“¦"},{value:"damaged_item",label:"Damaged Item",icon:"ðŸ’”"},{value:"missing_item",label:"Missing Item(s)",icon:"ðŸ”"},{value:"quality_issue",label:"Quality Issue",icon:"âš ï¸"},{value:"billing_issue",label:"Overcharged/Billing Issue",icon:"ðŸ’³"},{value:"delivery_not_attempted",label:"Delivery Not Attempted",icon:"ðŸš«"},{value:"other",label:"Other",icon:"ðŸ“"}],W=[{value:"full_refund",label:"Full Refund"},{value:"partial_refund",label:"Partial Refund"},{value:"replacement",label:"Replacement Item"},{value:"credit",label:"Credit for Future Purchase"},{value:"no_action",label:"Just Want to Report (No Action Needed)"}];return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Report an Issue"}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:"Help us resolve your concern by providing detailed information about the issue you experienced."})]}),M&&e.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-6 mb-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})}),i&&e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-6 mb-8",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"Order Context"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{className:"text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Order Number:"})," ",i.order.order_number]}),e.jsxs("p",{className:"text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Order Date:"})," ",new Date(i.order.order_date).toLocaleDateString()]}),e.jsxs("p",{className:"text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",i.order.status]}),e.jsxs("p",{className:"text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Total:"})," $",Number(i.order.total_amount).toFixed(2)]})]})]}),e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[i.items.length," item",i.items.length!==1?"s":""]})]})}),e.jsxs("form",{onSubmit:T,className:"space-y-8",children:[$&&e.jsx("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium text-red-800",children:$})})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"What went wrong?"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:O.map(s=>e.jsxs("button",{type:"button",onClick:()=>F(s.value),className:`
                      relative p-4 rounded-lg border-2 transition-all duration-200 text-left
                      ${r.issue_type===s.value?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 bg-white hover:border-blue-300 hover:bg-blue-50"}
                    `,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-2xl",children:s.icon}),e.jsx("span",{className:"font-medium text-gray-900",children:s.label})]}),r.issue_type===s.value&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("svg",{className:"h-5 w-5 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]},s.value))}),m.issue_type&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:m.issue_type})]}),i&&i.items.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Which items are affected?"}),e.jsx("div",{className:"space-y-3",children:i.items.map(s=>e.jsxs("label",{className:`
                        flex items-start p-4 rounded-lg border-2 cursor-pointer transition-all duration-200
                        ${r.affected_items.includes(s.order_item_id)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300 hover:bg-gray-50"}
                      `,children:[e.jsx("input",{type:"checkbox",checked:r.affected_items.includes(s.order_item_id),onChange:()=>R(s.order_item_id),className:"mt-1 h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.product_name}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["SKU: ",s.sku]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Quantity: ",s.quantity]})]})]},s.order_item_id))}),m.affected_items&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:m.affected_items})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Tell us what happened"}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-2",children:["Issue Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"description",rows:6,value:r.description,onChange:s=>z(s.target.value),placeholder:"Please describe what happened in detail. Include dates, times, and any relevant information that will help us understand the situation...",className:`
                    w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-4 focus:ring-blue-100 transition-all duration-200
                    ${m.description?"border-red-300 focus:border-red-500":"border-gray-200 focus:border-blue-500"}
                  `}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Minimum 50 characters, maximum 2000 characters"}),e.jsxs("p",{className:`text-xs font-medium ${r.description.length<50||r.description.length>2e3?"text-red-500":"text-gray-500"}`,children:[r.description.length," / 2000"]})]}),m.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:m.description})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-8",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:["Add Evidence Photos ",e.jsx("span",{className:"text-gray-500 text-sm font-normal",children:"(Optional but recommended)"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"photo-upload",className:`
                    flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-lg cursor-pointer transition-all duration-200
                    ${h.length>0?"border-blue-400 bg-blue-50 cursor-not-allowed":"border-gray-300 bg-gray-50 hover:border-blue-400 hover:bg-blue-50"}
                  `,children:[e.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[e.jsx("svg",{className:"w-10 h-10 mb-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsxs("p",{className:"mb-2 text-sm text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"JPG, PNG, or WEBP (Max 5MB per file, up to 10 files)"})]}),e.jsx("input",{id:"photo-upload",type:"file",multiple:!0,accept:"image/jpeg,image/png,image/webp",onChange:E,disabled:h.length>0,className:"hidden"})]}),h.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:h.map(s=>e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 truncate flex-1 mr-2",children:s}),e.jsxs("span",{className:"text-xs text-blue-600 font-medium",children:[I[s]||0,"%"]})]}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${I[s]||0}%`}})})]},s))}),L.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:L.map((s,t)=>e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-red-700",children:s})},t))}),r.evidence_photos.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 mb-3",children:["Uploaded Photos (",r.evidence_photos.length,"/10)"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:r.evidence_photos.map((s,t)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:s,alt:`Evidence ${t+1}`,className:"w-full h-32 object-cover rounded-lg border-2 border-gray-200"}),e.jsx("button",{type:"button",onClick:()=>U(s),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1.5 opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:bg-red-600","aria-label":"Remove photo",children:e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t))})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"What would you like us to do?"}),e.jsx("div",{className:"space-y-3",children:W.map(s=>e.jsxs("label",{className:`
                      flex items-center p-4 rounded-lg border-2 cursor-pointer transition-all duration-200
                      ${r.desired_resolution===s.value?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300 hover:bg-gray-50"}
                    `,children:[e.jsx("input",{type:"radio",name:"desired_resolution",value:s.value,checked:r.desired_resolution===s.value,onChange:t=>B(t.target.value),className:"h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsx("span",{className:"ml-3 font-medium text-gray-900",children:s.label})]},s.value))}),m.desired_resolution&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:m.desired_resolution})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("button",{type:"submit",disabled:C||h.length>0,className:"flex-1 px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl",children:C?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Submitting Issue..."]}):h.length>0?`Uploading ${h.length} photo${h.length!==1?"s":""}...`:"Submit Issue Report"}),e.jsx("button",{type:"button",onClick:()=>o(-1),className:"px-6 py-3 bg-gray-100 text-gray-900 font-medium rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-4 focus:ring-gray-100 transition-all duration-200 border border-gray-300",children:"Cancel"})]}),e.jsx("p",{className:"mt-4 text-sm text-gray-600 text-center",children:"We'll review your issue and get back to you within 24-48 hours."})]})]})]})})})};export{se as default};
