import{a as be,u as Y,b as z,j as e}from"./state-vendor-__gb9IU9.js";import{u as ge,r as o}from"./react-vendor-QYi6USC3.js";import{u as V,a as A}from"./index-CFqXVpuW.js";import{Y as D,q as pe,h as E,w as ee,J as ye,P as fe,ak as _e,C as je,al as Ne,u as se,a5 as ve}from"./ui-vendor-CuJPReAW.js";const we=async m=>{const{data:i}=await A.get("/cart",{headers:{Authorization:`Bearer ${m}`}});return i},Ce=async m=>{const{data:i}=await A.get("/addresses",{headers:{Authorization:`Bearer ${m}`}});return i},ke=async m=>{const{data:i}=await A.get("/payment-methods",{headers:{Authorization:`Bearer ${m}`}});return i},Se=async(m,i)=>{const{data:l}=await A.post("/addresses",i,{headers:{Authorization:`Bearer ${m}`}});return l},Ae=async(m,i)=>{const{data:l}=await A.post("/payment-methods",i,{headers:{Authorization:`Bearer ${m}`}});return l},$e=async(m,i)=>{const{data:l}=await A.post("/orders",i,{headers:{Authorization:`Bearer ${m}`}});return l},qe=()=>{const m=ge(),i=be(),l=V(s=>s.authentication_state.auth_token),r=V(s=>s.authentication_state.current_user),N=V(s=>s.authentication_state.customer_profile),q=V(s=>s.authentication_state.authentication_status.is_authenticated),[_,I]=o.useState(null),[T,B]=o.useState(!1),[u,b]=o.useState({full_name:`${(r==null?void 0:r.first_name)||""} ${(r==null?void 0:r.last_name)||""}`.trim(),phone_number:(r==null?void 0:r.phone_number)||"",street_address:"",apt_suite:"",city:"",state:"",postal_code:"",delivery_instructions:"",address_type:"residential"}),[$,te]=o.useState({}),[F,P]=o.useState(null),[v,L]=o.useState(!1),[p,re]=o.useState(!1),[d,y]=o.useState({card_number:"",card_expiry_month:"",card_expiry_year:"",cvv:"",cardholder_name:`${(r==null?void 0:r.first_name)||""} ${(r==null?void 0:r.last_name)||""}`.trim(),save_for_future:!0}),[K,ae]=o.useState(""),[R,le]=o.useState(!1),[c,f]=o.useState({}),[Q,de]=o.useState(!1),{data:x,isLoading:ne,error:H}=Y({queryKey:["cart"],queryFn:async()=>{var t;console.log("UV_Checkout: Fetching cart data with token:",(l==null?void 0:l.substring(0,20))+"...");const s=await we(l);return console.log("UV_Checkout: Cart data received:",{hasCart:!!s.cart,itemCount:((t=s.items)==null?void 0:t.length)||0,totalItems:s.total_items}),s},enabled:!!l&&!!q,staleTime:0,retry:!1}),{data:G,isLoading:ie}=Y({queryKey:["addresses"],queryFn:()=>Ce(l),enabled:!!l&&!!q,retry:!1}),{data:J,isLoading:ce}=Y({queryKey:["paymentMethods"],queryFn:()=>ke(l),enabled:!!l&&!!q,retry:!1}),j=Array.isArray(G)?G:[],w=Array.isArray(J)?J:[],O=z({mutationFn:s=>Se(l,s),onSuccess:s=>{i.invalidateQueries({queryKey:["addresses"]}),I(s.address_id),B(!1),b({full_name:`${(r==null?void 0:r.first_name)||""} ${(r==null?void 0:r.last_name)||""}`.trim(),phone_number:(r==null?void 0:r.phone_number)||"",street_address:"",apt_suite:"",city:"",state:"",postal_code:"",delivery_instructions:"",address_type:"residential"})},onError:s=>{f(t=>{var a,n;return{...t,address:((n=(a=s.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to add address"}})}}),X=z({mutationFn:s=>Ae(l,s),onSuccess:s=>{i.invalidateQueries({queryKey:["paymentMethods"]}),P(s.payment_method_id),L(!1),y({card_number:"",card_expiry_month:"",card_expiry_year:"",cvv:"",cardholder_name:`${(r==null?void 0:r.first_name)||""} ${(r==null?void 0:r.last_name)||""}`.trim(),save_for_future:!0})}}),Z=z({mutationFn:s=>$e(l,s),onSuccess:s=>{i.invalidateQueries({queryKey:["cart"]}),i.invalidateQueries({queryKey:["cart-summary"]}),i.invalidateQueries({queryKey:["orders"]}),m(`/order-confirmation?order_id=${s.order_id}`)},onError:s=>{f(t=>{var a,n;return{...t,submit:((n=(a=s.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to place order. Please try again."}})}}),C=o.useMemo(()=>{if(!(x!=null&&x.items))return[];const s={};return x.items.forEach(t=>{s[t.supplier_id]||(s[t.supplier_id]={supplier_id:t.supplier_id,supplier_name:t.business_name||t.supplier_name||"Unknown Supplier",logo_url:null,items:[],supplier_subtotal:0}),s[t.supplier_id].items.push(t);const a=Number(t.quantity)||0,n=Number(t.price_per_unit)||0;s[t.supplier_id].supplier_subtotal+=a*n}),Object.values(s)},[x]),g=o.useMemo(()=>{const s=Number(C.reduce((k,S)=>k+Number(S.supplier_subtotal||0),0)),t=Number(C.length*50),a=Number((s+t)*.08),n=0,h=Number(s+t+a-n);return{subtotal_amount:s,delivery_fee_total:t,tax_amount:a,discount_amount:n,total_amount:h}},[C]);o.useEffect(()=>{if(j.length>0&&!_){const s=j.find(t=>t.is_default)||j[0];I(s.address_id)}},[j,_]),o.useEffect(()=>{if(w.length>0&&!F&&!p){const s=w.find(t=>t.is_default)||w[0];P(s.payment_method_id)}},[w,F,p]);const oe=async()=>{if(f(s=>{const{address:t,...a}=s;return a}),!u.full_name||!u.phone_number||!u.street_address||!u.city||!u.state||!u.postal_code){f(s=>({...s,address:"All required fields must be filled"}));return}await O.mutateAsync({user_id:r==null?void 0:r.user_id,...u})},me=async()=>{f({});const s={};if(_||(s.address="Please select a delivery address"),C.filter(a=>!$[a.supplier_id]).length>0&&(s.delivery="Please select delivery windows for all suppliers"),!p&&!F&&!v&&(s.payment="Please select a payment method"),v&&((!d.card_number||d.card_number.length<15)&&(s.card_number="Valid card number required"),(!d.card_expiry_month||!d.card_expiry_year)&&(s.card_expiry="Valid expiry date required"),(!d.cvv||d.cvv.length<3)&&(s.cvv="Valid CVV required"),d.cardholder_name||(s.cardholder_name="Cardholder name required")),R||(s.terms="You must accept the Terms of Service"),Object.keys(s).length>0){f(s);return}try{v&&!p&&await X.mutateAsync({user_id:r==null?void 0:r.user_id,payment_type:"credit_card",card_brand:ue(d.card_number),card_last_four:d.card_number.slice(-4),card_expiry_month:d.card_expiry_month,card_expiry_year:d.card_expiry_year,cardholder_name:d.cardholder_name,payment_token:`tok_${Date.now()}`,is_default:d.save_for_future});const a=Object.entries($).map(([n])=>{const h=new Date;h.setDate(h.getDate()+1);const k=new Date(h);k.setHours(9,0,0);const S=new Date(h);return S.setHours(12,0,0),{supplier_id:n,delivery_window_start:k.toISOString(),delivery_window_end:S.toISOString(),delivery_method:"standard_delivery"}});await Z.mutateAsync({delivery_address_id:_,payment_method:p?"trade_credit":"credit_card",customer_notes:K||null,promo_code_used:null,delivery_windows:a})}catch(a){console.error("Order submission error:",a)}},ue=s=>{const t=s.replace(/\s/g,"");return t.startsWith("4")?"Visa":t.startsWith("5")?"Mastercard":t.startsWith("3")?"Amex":"Unknown"},xe=s=>(s.replace(/\D/g,"").match(/.{1,4}/g)||[]).join(" ").substring(0,19),he=ne||ie||ce,U=Z.isPending||O.isPending||X.isPending;if(!q||!l)return m("/login"),null;if(he)return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-64 mb-8"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-48"}),e.jsx("div",{className:"h-24 bg-gray-200 rounded"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-48"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 space-y-4 sticky top-24",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-32"}),e.jsx("div",{className:"h-48 bg-gray-200 rounded"})]})})]})]})})})});if(!(x!=null&&x.items)||x.items.length===0)return console.error("UV_Checkout: Cart is empty, redirecting to cart page. CartData:",x),H&&console.error("UV_Checkout: Cart fetch error:",H),m("/cart"),null;const M=j.find(s=>s.address_id===_),W=Number((N==null?void 0:N.trade_credit_balance)||0);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 py-8 sm:py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Checkout"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Complete your order securely"})]}),e.jsx("div",{className:"mb-8 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center",children:e.jsx(D,{className:"w-5 h-5"})}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-900",children:"Cart"})]}),e.jsx("div",{className:"w-16 h-0.5 bg-blue-600"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center font-semibold",children:"2"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-900",children:"Checkout"})]}),e.jsx("div",{className:"w-16 h-0.5 bg-gray-300"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center font-semibold",children:"3"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-500",children:"Confirmation"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 lg:p-8",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(pe,{className:"w-6 h-6 text-blue-600 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Delivery Address"})]}),c.address&&e.jsxs("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 flex items-start",children:[e.jsx(E,{className:"w-5 h-5 text-red-600 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:c.address})]}),j.length>0&&!T&&e.jsx("div",{className:"space-y-3",children:j.map(s=>e.jsxs("label",{className:`flex items-start p-4 border-2 rounded-lg cursor-pointer transition-all ${_===s.address_id?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"address",value:s.address_id,checked:_===s.address_id,onChange:()=>I(s.address_id),className:"mt-1 w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.full_name}),s.is_default&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:"Default"})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.street_address,s.apt_suite&&`, ${s.apt_suite}`]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.city,", ",s.state," ",s.postal_code]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.phone_number}),s.delivery_instructions&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2 italic",children:["Note: ",s.delivery_instructions]})]})]},s.address_id))}),T&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),e.jsx("input",{type:"text",value:u.full_name,onChange:s=>b(t=>({...t,full_name:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number *"}),e.jsx("input",{type:"tel",value:u.phone_number,onChange:s=>b(t=>({...t,phone_number:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Street Address *"}),e.jsx("input",{type:"text",value:u.street_address,onChange:s=>b(t=>({...t,street_address:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apt/Suite"}),e.jsx("input",{type:"text",value:u.apt_suite,onChange:s=>b(t=>({...t,apt_suite:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City *"}),e.jsx("input",{type:"text",value:u.city,onChange:s=>b(t=>({...t,city:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"State *"}),e.jsx("input",{type:"text",value:u.state,onChange:s=>b(t=>({...t,state:s.target.value})),maxLength:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Postal Code *"}),e.jsx("input",{type:"text",value:u.postal_code,onChange:s=>b(t=>({...t,postal_code:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Delivery Instructions"}),e.jsx("textarea",{value:u.delivery_instructions,onChange:s=>b(t=>({...t,delivery_instructions:s.target.value})),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., Leave at back door, call on arrival"})]}),e.jsxs("div",{className:"flex items-center space-x-3 pt-2",children:[e.jsx("button",{type:"button",onClick:oe,disabled:O.isPending,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:O.isPending?"Saving...":"Save Address"}),e.jsx("button",{type:"button",onClick:()=>B(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"})]})]}),!T&&e.jsxs("button",{type:"button",onClick:()=>B(!0),className:"mt-4 flex items-center text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors",children:[e.jsx(ee,{className:"w-4 h-4 mr-1"}),"Add New Address"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 lg:p-8",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(ye,{className:"w-6 h-6 text-blue-600 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Delivery Scheduling"})]}),c.delivery&&e.jsxs("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 flex items-start",children:[e.jsx(E,{className:"w-5 h-5 text-red-600 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:c.delivery})]}),M&&e.jsxs("div",{className:"mb-4 text-sm text-gray-600 bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Delivering to:"}),e.jsxs("p",{className:"text-blue-700",children:[M.street_address,", ",M.city,", ",M.state," ",M.postal_code]})]}),e.jsx("div",{className:"space-y-6",children:C.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.supplier_name}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.items.length," item",s.items.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3",children:["morning","afternoon"].map(t=>{const a=`${s.supplier_id}_${t}`,n=new Date;n.setDate(n.getDate()+1);const h=n.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),k=t==="morning"?"9AM - 12PM":"1PM - 5PM";return e.jsxs("label",{className:`flex items-start p-3 border-2 rounded-lg cursor-pointer transition-all ${$[s.supplier_id]===a?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:`delivery_${s.supplier_id}`,value:a,checked:$[s.supplier_id]===a,onChange:()=>te(S=>({...S,[s.supplier_id]:a})),className:"mt-1 w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:h}),e.jsx("div",{className:"text-sm text-gray-600",children:k}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"$50.00 delivery"})]}),$[s.supplier_id]===a&&e.jsx(D,{className:"w-5 h-5 text-blue-600 ml-2"})]},a)})})]},s.supplier_id))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 lg:p-8",children:[e.jsxs("button",{type:"button",onClick:()=>de(!Q),className:"flex items-center justify-between w-full mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(fe,{className:"w-6 h-6 text-blue-600 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Review Your Order"})]}),Q?e.jsx(_e,{className:"w-5 h-5 text-gray-500"}):e.jsx(je,{className:"w-5 h-5 text-gray-500"})]}),Q&&e.jsx("div",{className:"space-y-4 pt-2",children:C.map(s=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:s.supplier_name}),e.jsx("div",{className:"space-y-3",children:s.items.map(t=>e.jsxs("div",{className:"flex items-center space-x-3",children:[t.primary_image_url&&e.jsx("img",{src:t.primary_image_url,alt:t.product_name,className:"w-16 h-16 object-cover rounded-lg"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.product_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Qty: ",t.quantity," × $",Number(t.price_per_unit||0).toFixed(2)]})]}),e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:["$",(t.quantity*Number(t.price_per_unit||0)).toFixed(2)]})]},t.cart_item_id))}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Supplier Subtotal"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["$",s.supplier_subtotal.toFixed(2)]})]})]},s.supplier_id))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 lg:p-8",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(Ne,{className:"w-6 h-6 text-blue-600 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Payment Method"})]}),c.payment&&e.jsxs("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 flex items-start",children:[e.jsx(E,{className:"w-5 h-5 text-red-600 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:c.payment})]}),W>0&&(N==null?void 0:N.account_type)==="trade"&&e.jsx("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("label",{className:"flex items-start cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:s=>{re(s.target.checked),s.target.checked&&(P(null),L(!1))},className:"mt-1 w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("div",{className:"font-semibold text-green-900",children:"Use Trade Credit"}),e.jsxs("div",{className:"text-sm text-green-700 mt-1",children:["Available: $",Number(W).toFixed(2)," | Terms: Net 30 Days"]}),Number(g.total_amount)>Number(W)&&e.jsxs("div",{className:"text-xs text-green-600 mt-2",children:["$",Number(g.total_amount).toFixed(2)," exceeds available credit. Additional payment required."]})]})]})}),!p&&e.jsxs(e.Fragment,{children:[w.length>0&&!v&&e.jsx("div",{className:"space-y-3 mb-4",children:w.map(s=>e.jsxs("label",{className:`flex items-center p-4 border-2 rounded-lg cursor-pointer transition-all ${F===s.payment_method_id?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"payment",value:s.payment_method_id,checked:F===s.payment_method_id,onChange:()=>P(s.payment_method_id),className:"w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"}),e.jsxs("div",{className:"ml-3 flex-1 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[s.card_brand," •••• ",s.card_last_four]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Expires ",s.card_expiry_month,"/",s.card_expiry_year]})]}),s.is_default&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded",children:"Default"})]})]},s.payment_method_id))}),v&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Card Number *"}),e.jsx("input",{type:"text",value:d.card_number,onChange:s=>{const t=xe(s.target.value);y(a=>({...a,card_number:t})),f(a=>{const{card_number:n,...h}=a;return h})},maxLength:19,placeholder:"1234 5678 9012 3456",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${c.card_number?"border-red-300":"border-gray-300"}`}),c.card_number&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.card_number})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Month *"}),e.jsx("input",{type:"text",value:d.card_expiry_month,onChange:s=>{const t=s.target.value.replace(/\D/g,"").substring(0,2);y(a=>({...a,card_expiry_month:t}))},placeholder:"MM",maxLength:2,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${c.card_expiry?"border-red-300":"border-gray-300"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Year *"}),e.jsx("input",{type:"text",value:d.card_expiry_year,onChange:s=>{const t=s.target.value.replace(/\D/g,"").substring(0,4);y(a=>({...a,card_expiry_year:t}))},placeholder:"YYYY",maxLength:4,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${c.card_expiry?"border-red-300":"border-gray-300"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CVV *"}),e.jsx("input",{type:"text",value:d.cvv,onChange:s=>{const t=s.target.value.replace(/\D/g,"").substring(0,4);y(a=>({...a,cvv:t}))},placeholder:"123",maxLength:4,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${c.cvv?"border-red-300":"border-gray-300"}`})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cardholder Name *"}),e.jsx("input",{type:"text",value:d.cardholder_name,onChange:s=>y(t=>({...t,cardholder_name:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d.save_for_future,onChange:s=>y(t=>({...t,save_for_future:s.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Save this card for future purchases"})]}),e.jsx("button",{type:"button",onClick:()=>{L(!1),y({card_number:"",card_expiry_month:"",card_expiry_year:"",cvv:"",cardholder_name:`${(r==null?void 0:r.first_name)||""} ${(r==null?void 0:r.last_name)||""}`.trim(),save_for_future:!0})},className:"text-sm text-gray-600 hover:text-gray-800",children:"Cancel"})]}),!v&&!p&&e.jsxs("button",{type:"button",onClick:()=>{L(!0),P(null)},className:"flex items-center text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors",children:[e.jsx(ee,{className:"w-4 h-4 mr-1"}),"Add New Card"]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 flex items-center justify-center space-x-6 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"w-4 h-4 mr-1"}),"SSL Secure"]}),e.jsx("div",{children:"PCI Compliant"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 lg:p-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Order Notes (Optional)"}),e.jsx("textarea",{value:K,onChange:s=>ae(s.target.value),rows:3,maxLength:1e3,placeholder:"Any special instructions? (e.g., gate code, preferred contact time)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[K.length,"/1000 characters"]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 p-6 lg:p-8 sticky top-24",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Order Summary"}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Subtotal (",(x==null?void 0:x.total_items)||0," items)"]}),e.jsxs("span",{className:"font-medium text-gray-900",children:["$",Number(g.subtotal_amount).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Delivery Fees"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["$",Number(g.delivery_fee_total).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Estimated Tax"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["$",Number(g.tax_amount).toFixed(2)]})]}),g.discount_amount>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Discount"}),e.jsxs("span",{className:"font-medium text-green-600",children:["-$",Number(g.discount_amount).toFixed(2)]})]})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200 mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:["$",Number(g.total_amount).toFixed(2)]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"flex items-start cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:s=>{le(s.target.checked),f(t=>{const{terms:a,...n}=t;return n})},className:`mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 ${c.terms?"border-red-300":""}`}),e.jsxs("span",{className:"ml-2 text-sm text-gray-700",children:["I agree to the"," ",e.jsx("a",{href:"/terms",target:"_blank",className:"text-blue-600 hover:text-blue-700 underline",children:"Terms of Service"})," ","and"," ",e.jsx("a",{href:"/privacy",target:"_blank",className:"text-blue-600 hover:text-blue-700 underline",children:"Privacy Policy"})]})]}),c.terms&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:c.terms})]}),c.submit&&e.jsxs("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-lg p-3 flex items-start",children:[e.jsx(E,{className:"w-5 h-5 text-red-600 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:c.submit})]}),e.jsx("button",{type:"button",onClick:me,disabled:U,className:"w-full bg-blue-600 text-white py-4 px-6 rounded-lg font-semibold text-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg hover:shadow-xl flex items-center justify-center",children:U?e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-5 h-5 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-5 h-5 mr-2"}),"Place Order • $",Number(g.total_amount).toFixed(2)]})}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200 space-y-2 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(D,{className:"w-4 h-4 text-green-600 mr-2"}),e.jsx("span",{children:"Secure 256-bit SSL encryption"})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(D,{className:"w-4 h-4 text-green-600 mr-2"}),e.jsx("span",{children:"PCI DSS compliant payments"})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(D,{className:"w-4 h-4 text-green-600 mr-2"}),e.jsx("span",{children:"100% purchase protection"})]})]})]})})]})]})})})};export{qe as default};
