import{a as X,u as E,b as Z,j as e}from"./state-vendor-__gb9IU9.js";import{e as ee,r as u,L as _}from"./react-vendor-QYi6USC3.js";import{u as I,a as C}from"./index-C8z-Yyaa.js";import{X as M,aA as T,a8 as D,P as B,D as te,k as K,ai as se,S as re,a0 as ae,C as oe,Y as le,ah as ce,N as ne}from"./ui-vendor-CuJPReAW.js";const ie=async(c,o)=>{const a=new URLSearchParams;return o.search_query&&a.append("search_query",o.search_query),o.category_filter&&a.append("category_filter",o.category_filter),o.low_stock_only?a.append("status_filter","low_stock"):o.out_of_stock_only&&a.append("status_filter","out_of_stock"),a.append("sort_by","stock_quantity"),a.append("sort_order","asc"),a.append("limit","1000"),(await C.get(`https://123create-construction-app-with-a.launchpulse.ai/api/suppliers/me/products?${a.toString()}`,{headers:{Authorization:`Bearer ${c}`}})).data},de=async(c,o,a)=>(await C.patch(`https://123create-construction-app-with-a.launchpulse.ai/api/products/${o}`,{stock_quantity:a,last_updated_timestamp:new Date().toISOString()},{headers:{Authorization:`Bearer ${c}`}})).data,ue=async()=>(await C.get("https://123create-construction-app-with-a.launchpulse.ai/api/categories?is_active=true")).data,ye=()=>{const c=I(t=>t.authentication_state.auth_token),o=I(t=>t.authentication_state.supplier_profile),[a,p]=ee(),V=X(),[r,P]=u.useState({low_stock_only:a.get("low_stock_only")==="true",out_of_stock_only:a.get("out_of_stock_only")==="true",search_query:a.get("search_query")||"",category_filter:a.get("category_filter")||null}),[i,y]=u.useState({selected_product_ids:[],bulk_action:null,bulk_value:null,processing:!1}),[O,f]=u.useState(null),[b,j]=u.useState(0);u.useEffect(()=>{const t=new URLSearchParams;r.low_stock_only&&t.set("low_stock_only","true"),r.out_of_stock_only&&t.set("out_of_stock_only","true"),r.search_query&&t.set("search_query",r.search_query),r.category_filter&&t.set("category_filter",r.category_filter),p(t,{replace:!0})},[r,p]);const{data:l,isLoading:x,error:g,refetch:F}=E({queryKey:["supplier-inventory",r],queryFn:()=>ie(c,r),enabled:!!c&&!!o,staleTime:3e4,refetchOnWindowFocus:!0}),{data:N}=E({queryKey:["categories"],queryFn:ue,staleTime:3e5}),n=u.useMemo(()=>{if(!(l!=null&&l.products))return[];let t=l.products;return r.low_stock_only&&(t=t.filter(s=>Number(s.stock_quantity)<=Number(s.low_stock_threshold)&&Number(s.stock_quantity)>0)),r.out_of_stock_only&&(t=t.filter(s=>Number(s.stock_quantity)===0)),t},[l,r]),d=u.useMemo(()=>{if(!(l!=null&&l.products))return{total_products:0,total_stock_value:0,low_stock_count:0,out_of_stock_count:0};const t=l.products;return{total_products:t.length,total_stock_value:t.reduce((s,h)=>s+(Number(h.stock_quantity)||0)*(Number(h.cost_price)||Number(h.price_per_unit)||0),0),low_stock_count:t.filter(s=>Number(s.stock_quantity)<=Number(s.low_stock_threshold)&&Number(s.stock_quantity)>0).length,out_of_stock_count:t.filter(s=>Number(s.stock_quantity)===0).length}},[l]),$=Z({mutationFn:({product_id:t,stock_quantity:s})=>de(c,t,s),onSuccess:()=>{V.invalidateQueries({queryKey:["supplier-inventory"]}),f(null)}}),m=t=>{P(s=>({...s,...t}))},R=t=>{m({search_query:t})},Q=t=>{m({category_filter:t})},L=()=>{P({low_stock_only:!1,out_of_stock_only:!1,search_query:"",category_filter:null})},Y=t=>{f(t.product_id),j(t.stock_quantity)},U=()=>{f(null),j(0)},A=async t=>{if(b<0){alert("Stock quantity cannot be negative");return}try{await $.mutateAsync({product_id:t,stock_quantity:b})}catch(s){console.error("Failed to update stock:",s),alert("Failed to update stock. Please try again.")}},z=(t,s)=>{t.key==="Enter"?A(s):t.key==="Escape"&&U()},G=t=>{y(s=>({...s,selected_product_ids:s.selected_product_ids.includes(t)?s.selected_product_ids.filter(h=>h!==t):[...s.selected_product_ids,t]}))},H=()=>{i.selected_product_ids.length===n.length?y(t=>({...t,selected_product_ids:[]})):y(t=>({...t,selected_product_ids:n.map(s=>s.product_id)}))},J=t=>t.stock_quantity===0?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"Out of Stock"}):Number(t.stock_quantity)<=Number(t.low_stock_threshold)?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Low Stock"}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"In Stock"}),w=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),W=t=>{const s=new Date(t),k=new Date().getTime()-s.getTime(),v=Math.floor(k/6e4),S=Math.floor(k/36e5),q=Math.floor(k/864e5);return v<1?"Just now":v<60?`${v} min ago`:S<24?`${S} hour${S>1?"s":""} ago`:q<7?`${q} day${q>1?"s":""} ago`:s.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})};return!c||!o?e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600",children:"Please log in to access inventory management."}),e.jsx(_,{to:"/login",className:"mt-4 inline-block text-blue-600 hover:text-blue-700",children:"Go to Login"})]})})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Inventory Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Track and manage your product stock levels"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[i.selected_product_ids.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2 bg-blue-50 border border-blue-200 rounded-lg px-4 py-2",children:[e.jsxs("span",{className:"text-sm font-medium text-blue-800",children:[i.selected_product_ids.length," selected"]}),e.jsx("button",{onClick:()=>y(t=>({...t,selected_product_ids:[]})),className:"text-blue-600 hover:text-blue-700",children:e.jsx(M,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:()=>alert("Bulk update functionality coming soon! You can update stock quantities individually for now."),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Bulk Update"]})]}),e.jsxs("button",{onClick:()=>F(),disabled:x,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors disabled:opacity-50",children:[e.jsx(D,{className:`w-4 h-4 mr-2 ${x?"animate-spin":""}`}),"Refresh"]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Products"}),e.jsx("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:d.total_products})]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(B,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Stock Value"}),e.jsx("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:w(d.total_stock_value)})]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(te,{className:"w-6 h-6 text-green-600"})})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Low Stock Items"}),e.jsx("p",{className:"mt-2 text-3xl font-bold text-yellow-600",children:d.low_stock_count})]}),e.jsx("div",{className:"p-3 bg-yellow-100 rounded-lg",children:e.jsx(K,{className:"w-6 h-6 text-yellow-600"})})]}),d.low_stock_count>0&&e.jsx("button",{onClick:()=>m({low_stock_only:!0,out_of_stock_only:!1}),className:"mt-3 text-xs text-yellow-700 hover:text-yellow-800 font-medium",children:"View low stock items →"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Out of Stock"}),e.jsx("p",{className:"mt-2 text-3xl font-bold text-red-600",children:d.out_of_stock_count})]}),e.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:e.jsx(se,{className:"w-6 h-6 text-red-600"})})]}),d.out_of_stock_count>0&&e.jsx("button",{onClick:()=>m({out_of_stock_only:!0,low_stock_only:!1}),className:"mt-3 text-xs text-red-700 hover:text-red-800 font-medium",children:"View out of stock →"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name or SKU...",value:r.search_query,onChange:t=>R(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"}),e.jsxs("select",{value:r.category_filter||"",onChange:t=>Q(t.target.value||null),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm appearance-none bg-white",children:[e.jsx("option",{value:"",children:"All Categories"}),N==null?void 0:N.map(t=>e.jsx("option",{value:t.category_id,children:t.category_name},t.category_id))]}),e.jsx(oe,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.low_stock_only,onChange:t=>m({low_stock_only:t.target.checked,out_of_stock_only:!1}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Low Stock"})]}),e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.out_of_stock_only,onChange:t=>m({out_of_stock_only:t.target.checked,low_stock_only:!1}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Out of Stock"})]})]})]}),(r.search_query||r.category_filter||r.low_stock_only||r.out_of_stock_only)&&e.jsx("button",{onClick:L,className:"text-sm text-gray-600 hover:text-gray-900 font-medium whitespace-nowrap",children:"Clear Filters"})]})}),g&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(K,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Failed to load inventory"}),e.jsx("p",{className:"mt-1 text-sm text-red-700",children:g instanceof Error?g.message:"An error occurred"}),e.jsx("button",{onClick:()=>F(),className:"mt-2 text-sm font-medium text-red-800 hover:text-red-900",children:"Try again →"})]})]})}),x&&e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(D,{className:"w-8 h-8 text-blue-600 animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading inventory..."})]})}),!x&&n.length>0&&e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:i.selected_product_ids.length===n.length&&n.length>0,onChange:H,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Threshold"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock Value"}),e.jsx("th",{scope:"col",className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:i.selected_product_ids.includes(t.product_id),onChange:()=>G(t.product_id),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[t.primary_image_url?e.jsx("img",{src:t.primary_image_url,alt:t.product_name,className:"w-10 h-10 rounded-lg object-cover mr-3"}):e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-200 flex items-center justify-center mr-3",children:e.jsx(B,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"max-w-xs",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.product_name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[w(t.price_per_unit),"/",t.unit_of_measure]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("p",{className:"text-sm text-gray-900 font-mono",children:t.sku})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:O===t.product_id?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"number",min:"0",value:b,onChange:s=>j(Number(s.target.value)),onKeyPress:s=>z(s,t.product_id),autoFocus:!0,className:"w-24 px-2 py-1 border border-blue-500 rounded focus:ring-2 focus:ring-blue-500 text-sm"}),e.jsx("button",{onClick:()=>A(t.product_id),disabled:$.isPending,className:"p-1 text-green-600 hover:text-green-700 disabled:opacity-50",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx("button",{onClick:U,className:"p-1 text-red-600 hover:text-red-700",children:e.jsx(M,{className:"w-4 h-4"})})]}):e.jsxs("button",{onClick:()=>Y(t),className:"group flex items-center space-x-2 hover:bg-gray-100 rounded px-2 py-1 transition-colors",children:[e.jsx("span",{className:`text-sm font-semibold ${Number(t.stock_quantity)===0?"text-red-600":Number(t.stock_quantity)<=Number(t.low_stock_threshold)?"text-yellow-600":"text-gray-900"}`,children:t.stock_quantity}),e.jsx(ce,{className:"w-3 h-3 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("p",{className:"text-sm text-gray-600",children:t.low_stock_threshold})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:J(t)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(ne,{className:"w-4 h-4 mr-1.5 text-gray-400"}),W(t.last_updated_timestamp)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsx("p",{className:"text-sm font-medium text-gray-900",children:w((t.stock_quantity||0)*(t.cost_price||t.price_per_unit||0))})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx(_,{to:`/supplier/products/${t.product_id}/edit`,className:"text-blue-600 hover:text-blue-700 transition-colors",children:"Edit"})})]},t.product_id))})]})})}),!x&&n.length===0&&!g&&e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"p-4 bg-gray-100 rounded-full mb-4",children:e.jsx(T,{className:"w-12 h-12 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:r.search_query||r.category_filter||r.low_stock_only||r.out_of_stock_only?"No products match your filters":"No products in inventory yet"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md",children:r.search_query||r.category_filter||r.low_stock_only||r.out_of_stock_only?"Try adjusting your filters to see more results.":"Start by adding products to your catalog."}),r.search_query||r.category_filter||r.low_stock_only||r.out_of_stock_only?e.jsx("button",{onClick:L,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:"Clear all filters"}):e.jsx(_,{to:"/supplier/products/add",className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"Add Your First Product"})]})}),!x&&n.length>0&&e.jsxs("div",{className:"mt-6 flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("span",{children:["Showing ",n.length," of ",d.total_products," products"]}),i.selected_product_ids.length>0&&e.jsxs("span",{className:"text-blue-600 font-medium",children:[i.selected_product_ids.length," selected"]})]}),e.jsx(_,{to:"/supplier/products",className:"text-blue-600 hover:text-blue-700 font-medium transition-colors",children:"Manage All Products →"})]})]})]})})};export{ye as default};
