import{a as H,u as J,b as A,j as e}from"./state-vendor-__gb9IU9.js";import{r as l,L as E}from"./react-vendor-QYi6USC3.js";import{u as D,a as b}from"./index-CFqXVpuW.js";import{h as F,g as q,$ as Z,f as M,ah as ee,x as se,X as z,at as te}from"./ui-vendor-CuJPReAW.js";const w="https://123create-construction-app-with-a.launchpulse.ai",k=c=>{const i=new Date(c).getTime(),h=Date.now(),y=30*24*60*60*1e3;return h-i<=y},T=c=>new Date(c).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),ne=()=>{const c=D(s=>s.authentication_state.current_user),i=D(s=>s.authentication_state.auth_token),h=(c==null?void 0:c.user_type)==="customer"?c.user_id:null,y=H(),[n,R]=l.useState({sort_by:"review_date",sort_order:"desc",status_filter:"all"}),[a,o]=l.useState({review_id:null,review_text:"",photos:[],is_editing:!1,validation_errors:{}}),[f,_]=l.useState({is_open:!1,review_id:null}),[N,P]=l.useState(!1),{data:x,isLoading:C,error:u,refetch:U}=J({queryKey:["my-reviews",h,n],queryFn:async()=>{if(!h||!i)throw new Error("Authentication required");const s=await b.get(`${w}/reviews`,{params:{user_id:h,limit:50,offset:0,sort_by:n.sort_by,sort_order:n.sort_order,...n.status_filter!=="all"&&{status:n.status_filter}},headers:{Authorization:`Bearer ${i}`}});return{reviews:s.data.reviews||[],pagination:{current_page:1,total_pages:Math.ceil((s.data.total||0)/50),total_count:s.data.total||0}}},enabled:!!h&&!!i,staleTime:6e4,refetchOnWindowFocus:!1,retry:1}),p=A({mutationFn:async({review_id:s,review_text:t,photos:r})=>{if(!i)throw new Error("Authentication required");return(await b.patch(`${w}/reviews/${s}`,{review_text:t,photos:r},{headers:{Authorization:`Bearer ${i}`}})).data},onSuccess:()=>{y.invalidateQueries({queryKey:["my-reviews"]}),o({review_id:null,review_text:"",photos:[],is_editing:!1,validation_errors:{}})},onError:s=>{o(t=>{var r,m;return{...t,validation_errors:{submit:((m=(r=s.response)==null?void 0:r.data)==null?void 0:m.message)||"Failed to update review. Please try again."}}})}}),g=A({mutationFn:async s=>{if(!i)throw new Error("Authentication required");await b.delete(`${w}/reviews/${s}`,{headers:{Authorization:`Bearer ${i}`}})},onSuccess:()=>{y.invalidateQueries({queryKey:["my-reviews"]}),_({is_open:!1,review_id:null})},onError:s=>{var t,r;alert(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to delete review. Please try again.")}}),S=l.useCallback(s=>{R(t=>({...t,sort_by:s,sort_order:t.sort_by===s&&t.sort_order==="desc"?"asc":"desc"}))},[]),B=l.useCallback(s=>{R(t=>({...t,status_filter:s}))},[]),L=l.useCallback(s=>{if(!k(s.review_date)){alert("Reviews can only be edited within 30 days of posting.");return}o({review_id:s.review_id,review_text:s.review_text||"",photos:s.photos||[],is_editing:!0,validation_errors:{}})},[]),$=l.useCallback(()=>{o({review_id:null,review_text:"",photos:[],is_editing:!1,validation_errors:{}})},[]),O=l.useCallback(()=>{const s={};if(a.review_text.trim().length<10&&(s.review_text="Review must be at least 10 characters long."),a.review_text.length>2e3&&(s.review_text="Review must not exceed 2000 characters."),Object.keys(s).length>0){o(t=>({...t,validation_errors:s}));return}a.review_id&&p.mutate({review_id:a.review_id,review_text:a.review_text,photos:a.photos})},[a,p]),Y=l.useCallback(s=>{_({is_open:!0,review_id:s})},[]),Q=l.useCallback(()=>{f.review_id&&g.mutate(f.review_id)},[f.review_id,g]),K=l.useCallback(()=>{_({is_open:!1,review_id:null})},[]),V=l.useCallback(async s=>{const t=s.target.files;if(!(!t||t.length===0)){P(!0);try{const r=Array.from(t).map(async d=>{const j=await b.post(`${w}/uploads/request-url`,{file_type:d.type,file_size:d.size,upload_context:"review",entity_id:a.review_id},{headers:{Authorization:`Bearer ${i}`}}),{upload_url:X,cdn_url:G}=j.data;return await b.put(X,d,{headers:{"Content-Type":d.type}}),G}),m=await Promise.all(r);o(d=>({...d,photos:[...d.photos,...m]}))}catch(r){o(m=>{var d,j;return{...m,validation_errors:{photos:((j=(d=r.response)==null?void 0:d.data)==null?void 0:j.message)||"Failed to upload photos. Please try again."}}})}finally{P(!1)}}},[a.review_id,i]),I=l.useCallback(s=>{o(t=>({...t,photos:t.photos.filter(r=>r!==s)}))},[]),v=s=>e.jsx("div",{className:"flex items-center space-x-1",children:[1,2,3,4,5].map(t=>e.jsx(q,{className:`w-5 h-5 ${t<=s?"fill-yellow-400 text-yellow-400":"fill-gray-200 text-gray-200"}`},t))}),W=s=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[s.rating_product!==null&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-500 mb-1",children:"Product Quality"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[v(s.rating_product),e.jsxs("span",{className:"text-gray-700 font-medium",children:[s.rating_product,"/5"]})]})]}),s.rating_service!==null&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-500 mb-1",children:"Service"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[v(s.rating_service),e.jsxs("span",{className:"text-gray-700 font-medium",children:[s.rating_service,"/5"]})]})]}),s.rating_delivery!==null&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-500 mb-1",children:"Delivery"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[v(s.rating_delivery),e.jsxs("span",{className:"text-gray-700 font-medium",children:[s.rating_delivery,"/5"]})]})]})]});return e.jsx(e.Fragment,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-2",children:"My Reviews"}),e.jsx("p",{className:"text-gray-600 leading-relaxed",children:"Manage your product and supplier reviews. You can edit reviews within 30 days of posting."})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Sort by:"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>S("review_date"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${n.sort_by==="review_date"?"bg-blue-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Date ",n.sort_by==="review_date"&&(n.sort_order==="desc"?"↓":"↑")]}),e.jsxs("button",{onClick:()=>S("rating_overall"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${n.sort_by==="rating_overall"?"bg-blue-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Rating ",n.sort_by==="rating_overall"&&(n.sort_order==="desc"?"↓":"↑")]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Status:"}),e.jsxs("select",{value:n.status_filter,onChange:s=>B(s.target.value),className:"px-4 py-2 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 text-sm font-medium text-gray-700 transition-all",children:[e.jsx("option",{value:"all",children:"All Reviews"}),e.jsx("option",{value:"published",children:"Published"}),e.jsx("option",{value:"pending",children:"Pending"})]})]}),x&&e.jsxs("div",{className:"text-sm text-gray-600",children:[x.pagination.total_count," ",x.pagination.total_count===1?"review":"reviews"]})]})}),C&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading your reviews..."})]}),u&&e.jsx("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-6 mb-8",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(F,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:"Error Loading Reviews"}),e.jsx("p",{className:"text-red-700 mb-4",children:u instanceof Error?u.message:"An unexpected error occurred."}),e.jsx("button",{onClick:()=>U(),className:"bg-red-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-red-700 transition-colors",children:"Try Again"})]})]})}),!C&&!u&&x&&x.reviews.length===0&&e.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-12 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(q,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:"No Reviews Yet"}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-6",children:"You haven't written any reviews yet. After receiving your orders, you can share your experience to help other buyers make informed decisions."}),e.jsx(E,{to:"/orders",className:"inline-block bg-blue-600 text-white px-8 py-3 rounded-lg font-medium hover:bg-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:"View My Orders"})]})}),!C&&!u&&x&&x.reviews.length>0&&e.jsx("div",{className:"space-y-6",children:x.reviews.map(s=>e.jsx("article",{className:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden hover:shadow-xl transition-all duration-200",children:e.jsxs("div",{className:"p-6 lg:p-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between mb-6 pb-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start space-x-4 mb-4",children:[s.product_id&&e.jsx(E,{to:`/product/${s.product_id}`,className:"flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden hover:opacity-80 transition-opacity",children:e.jsx("img",{src:"https://via.placeholder.com/80?text=Product",alt:"Product",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:["Review for Order #",s.order_id.slice(0,8)]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Z,{className:"w-4 h-4 mr-1"}),T(s.review_date)]}),s.verified_purchase&&e.jsxs("span",{className:"flex items-center bg-green-50 text-green-700 px-2 py-1 rounded-md",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Verified Purchase"]}),e.jsx("span",{className:`px-2 py-1 rounded-md text-xs font-medium ${s.status==="published"?"bg-green-50 text-green-700":s.status==="pending"?"bg-amber-50 text-amber-700":"bg-red-50 text-red-700"}`,children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[v(s.rating_overall),e.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:[s.rating_overall,"/5"]})]}),(s.rating_product!==null||s.rating_service!==null||s.rating_delivery!==null)&&e.jsx("div",{className:"mt-4",children:W(s)})]})]}),e.jsxs("div",{className:"flex md:flex-col space-x-2 md:space-x-0 md:space-y-2 mt-4 md:mt-0",children:[k(s.review_date)&&e.jsxs("button",{onClick:()=>L(s),className:"flex items-center justify-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200 font-medium text-sm",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:"Edit"})]}),e.jsxs("button",{onClick:()=>Y(s.review_id),className:"flex items-center justify-center space-x-2 px-4 py-2 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-all duration-200 font-medium text-sm",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:"Delete"})]})]})]}),s.review_text&&e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",children:s.review_text})}),s.photos&&s.photos.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:s.photos.map((t,r)=>e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-gray-100 hover:opacity-90 transition-opacity cursor-pointer",children:e.jsx("img",{src:t,alt:`Review photo ${r+1}`,className:"w-full h-full object-cover"})},r))})}),s.supplier_response&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-600 p-6 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"S"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Supplier Response"}),s.supplier_response_date&&e.jsx("span",{className:"text-xs text-gray-500",children:T(s.supplier_response_date)})]}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:s.supplier_response})]})]})}),e.jsxs("div",{className:"mt-6 flex flex-wrap items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(M,{className:"w-4 h-4 mr-1 text-green-600"}),s.helpful_votes," ",s.helpful_votes===1?"person":"people"," found this helpful"]}),s.would_buy_again&&e.jsxs("span",{className:"flex items-center",children:["Would buy again:"," ",e.jsx("span",{className:`ml-1 font-medium ${s.would_buy_again==="yes"?"text-green-600":s.would_buy_again==="no"?"text-red-600":"text-amber-600"}`,children:s.would_buy_again==="yes"?"Yes":s.would_buy_again==="no"?"No":"Maybe"})]}),!k(s.review_date)&&e.jsx("span",{className:"text-gray-400 italic",children:"Edit window expired (30 days)"})]})]})},s.review_id))}),a.is_editing&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:"Edit Review"}),e.jsx("button",{onClick:$,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close modal",children:e.jsx(z,{className:"w-6 h-6 text-gray-500"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"review_text",className:"block text-sm font-medium text-gray-700 mb-2",children:"Your Review"}),e.jsx("textarea",{id:"review_text",value:a.review_text,onChange:s=>{o(t=>({...t,review_text:s.target.value,validation_errors:{...t.validation_errors,review_text:""}}))},rows:6,className:"w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-100 resize-none transition-all",placeholder:"Share your experience with this product..."}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[a.review_text.length," / 2000 characters"]}),a.validation_errors.review_text&&e.jsx("span",{className:"text-sm text-red-600",children:a.validation_errors.review_text})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Photos (Optional)"}),a.photos.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-4 mb-4",children:a.photos.map((s,t)=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-gray-100",children:[e.jsx("img",{src:s,alt:`Review photo ${t+1}`,className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>I(s),className:"absolute top-2 right-2 p-1 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors shadow-lg","aria-label":"Remove photo",children:e.jsx(z,{className:"w-4 h-4"})})]},t))}),a.photos.length<5&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"photo_upload",className:`flex items-center justify-center space-x-2 px-6 py-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all duration-200 cursor-pointer ${N?"opacity-50 cursor-not-allowed":""}`,children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-blue-600 font-medium",children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-5 h-5 text-gray-500"}),e.jsxs("span",{className:"text-gray-700 font-medium",children:["Add Photos (",a.photos.length,"/5)"]})]})}),e.jsx("input",{id:"photo_upload",type:"file",accept:"image/jpeg,image/png,image/webp",multiple:!0,onChange:V,disabled:N,className:"hidden"})]}),a.validation_errors.photos&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:a.validation_errors.photos})]}),a.validation_errors.submit&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-red-700",children:a.validation_errors.submit})})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gray-50 border-t border-gray-200 px-6 py-4 flex items-center justify-end space-x-3",children:[e.jsx("button",{onClick:$,disabled:p.isPending,className:"px-6 py-2 bg-white border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-all duration-200 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:O,disabled:p.isPending,className:"px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:p.isPending?e.jsxs("span",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):"Save Changes"})]})]})}),f.is_open&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Delete Review"})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(F,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-700 leading-relaxed mb-4",children:"Are you sure you want to delete this review? This action cannot be undone."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Your review helps other buyers make informed decisions. Consider editing instead of deleting."})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex items-center justify-end space-x-3 rounded-b-xl",children:[e.jsx("button",{onClick:K,disabled:g.isPending,className:"px-6 py-2 bg-white border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-all duration-200 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:Q,disabled:g.isPending,className:"px-6 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed",children:g.isPending?e.jsxs("span",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Deleting..."]}):"Delete Review"})]})]})})]})})})};export{ne as default};
